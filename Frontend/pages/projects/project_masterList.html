<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Project List / Aishalaya</title>
    <link rel="shortcut icon" href="../../assets/images/aishLogo.ico"/>
    
    <!-- plugins:css -->
    <link rel="stylesheet" href="../../assets/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="../../assets/vendors/css/vendor.bundle.base.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <!-- End Plugin css for this page -->
    <!-- inject:css -->
    <!-- endinject -->
    <!-- Layout styles -->
    <link rel="stylesheet" href="http://127.0.0.1:5500/assets/css/style.css">
 
    <!-- End layout styles -->
  <!--showalert Message-->
  <script src="http://127.0.0.1:5500/assets/js/alertMessages.js"></script>
 
   
    <style>
      /* Adjust the modal size */
      .modal-dialog {
        max-width: 1100px; /* Set your desired maximum width */
      }
    
      /* Adjust the form size */
      .form-sample {
        max-width: 100%; /* Set your desired maximum width */
      }
      @media (min-width: 576px){
        .col-sm-9{
              -webkit-box-flex: 0;
              -ms-flex: 0 0 auto;
              flex: 0 0 auto;
            width: 100% !important;
        }}
        
    </style>


  </head>
  <body>
    <div class="container-scroller">
      <!-- partial:../../partials/_navbar.html -->
  <!-- partial -->
  <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
    <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
      <a class="navbar-brand brand-logo" href="../../index.html"><img src="../../assets/images/logo.png" alt="logo" style="height: 100%;"/></a>
      <a class="navbar-brand brand-logo-mini" href="../../index.html"><img src="../../assets/images/logo.png" alt="logo" style="height: 100%;"/></a>
      </div>
    <div class="navbar-menu-wrapper d-flex align-items-stretch">
      <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
        <span class="mdi mdi-menu"></span>
      </button>
      <ul class="navbar-nav navbar-nav-right">
        <li class="nav-item d-none d-lg-block full-screen-link">
          <a class="nav-link">
            <i class="mdi mdi-fullscreen" id="fullscreen-button"></i>
          </a>
        </li>
        <li class="nav-item nav-logout d-none d-lg-block">
          <a class="nav-link"  onclick="logout()">
            <i class="mdi mdi-power"></i>
          </a>
        </li>

      </ul>
      <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
        <span class="mdi mdi-menu"></span>
      </button>
    </div>
  </nav>

    <!-- Your HTML content here -->

    <!-- Include Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- Your custom JavaScript code here -->
     
      <div class="container-fluid page-body-wrapper">
        <div id="includeHtml"></div>

        <div class="modal fade" id="projectModal" tabindex="-1" role="dialog" aria-labelledby="projectModalLabel" aria-hidden="true" >
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="projectModalLabel">Edit Project</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="closeForm()">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <!-- Employee Form -->
                <form class="form-sample" id="projectForm">
                  <p class="card-description">Project Info</p>
                  <div class="row">
        
                    

                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="companyName">Company Name</label>
                        <div class="col-sm-6">
                          <input class="form-control" type="text" id="companyName" name="companyName"><br>
                        </div>
                      </div>
                    </div>
                  
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="projectName">Project Name</label>
                        <div class="col-sm-6">
                          <input class="form-control" type="text" id="projectName" name="projectName"><br>
                        </div>
                      </div>
                    </div>

    
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="launchDate">Launch Date</label>
                        <div class="col-sm-6">
                          <input class="form-control" type="text" id="launchDate" name="launchDate"><br>
                        </div>
                      </div>
                    </div>

                    
                    

                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="landType">LandType</label>
                        <div class="col-sm-6">
                          <input class="form-control" type="text" id="landType" name="landType"  oninput="validateNo(event)"/>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <div class="form-group row" for="district">
                        <label class="col-sm-4 col-form-label">District</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="district" name="district" />
                        </div>
                      </div>
                    </div>
  
                    <div class="col-md-4">
                      <div class="form-group row" for="taluk">
                        <label class="col-sm-4 col-form-label">Taluk</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="taluk" name="taluk"  oninput="validateNo(event)"/>
                        </div>
                      </div>
                    </div>



                    <div class="col-md-4">
                      <div class="form-group row" for="village">
                        <label class="col-sm-4 col-form-label">Village</label>
                        <div class="col-sm-6">
                          <input type="text" class="form-control" id="village" name="village" />
                        </div>
                      </div>
                    </div> 
  
                
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="extent">Extent</label>
                        <div class="col-sm-6">
                          <input class="form-control" type="text" id="extent" name="extent" />
                        </div>
                      </div>
                    </div>
  
  

                   
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="address">Address</label>
                        <div class="col-sm-6">
                          <input type="text" id="address" name="address" class="form-control" />
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="geoLocation">Geo Location</label>
                        <div class="col-sm-6">
                          <input type="text" id="geoLocation" name="geoLocation" class="form-control" />
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="totalSiteSqft">Total Site Sqft</label>
                        <div class="col-sm-6">
                          <input class="form-control" type="text" id="totalSiteSqft" name="totalSiteSqft" />
                        </div>
                      </div>
                    </div>


                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="totalSiteCent">Total Site Cent</label>
                        <div class="col-sm-6">
                          <input type="text" id="totalSiteCent" name="totalSiteCent" class="form-control" />
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="saleableSqft">Saleable Sqft</label>
                        <div class="col-sm-6">
                          <input type="text" id="saleableSqft" name="saleableSqft" class="form-control" />
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="saleableCent">Saleable Cent</label>
                        <div class="col-sm-6">
                          <input type="text" id="saleableCent" name="saleableCent" class="form-control" />
                        </div>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="roadSqft">Road Sqft</label>
                        <div class="col-sm-6">
                          <input type="text" id="roadSqft" name="roadSqft" class="form-control" />
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="roadCent">Road Cent</label>
                        <div class="col-sm-6">
                          <input type="text" id="roadCent" name="roadCent" class="form-control" />
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="totalPlots">Total Plots</label>
                        <div class="col-sm-6">
                          <input type="text" id="totalPlots" name="totalPlots" class="form-control" />
                        </div>
                      </div>
                    </div>
                    
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="eastDetails">East Details</label>
                        <div class="col-sm-6">
                          <input type="text" id="eastDetails" name="eastDetails" class="form-control"  oninput="validateNo(event)"/>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="westDetails">West Details</label>
                        <div class="col-sm-6">
                          <input type="text" id="westDetails" name="westDetails" class="form-control"  oninput="validateNo(event)"/>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="northDetails">North Details</label>
                        <div class="col-sm-6">
                          <input type="text" id="northDetails" name="northDetails" class="form-control"  oninput="validateNo(event)"/>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="southDetails">South Details</label>
                        <div class="col-sm-6">
                          <input type="text" id="southDetails" name="southDetails" class="form-control"  oninput="validateNo(event)"/>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="prevOwnerName">PrevOwner Name</label>
                        <div class="col-sm-6">
                          <input type="text" id="prevOwnerName" name="prevOwnerName" class="form-control" />
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="prevOwnerContact">PrevOwner Contact</label>
                        <div class="col-sm-6">
                          <input type="text" id="prevOwnerContact" name="prevOwnerContact" class="form-control" />
                        </div>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="prevOwnerAddress">PrevOwner Address</label>
                        <div class="col-sm-6">
                          <input type="text" id="prevOwnerAddress" name="prevOwnerAddress" class="form-control" />
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="agreementDetails">Agreement Details</label>
                        <div class="col-sm-6">
                          <input type="text" id="agreementDetails" name="agreementDetails" class="form-control" />
                        </div>
                      </div>
                    </div>  

                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="draftDetails">Draft Details</label>
                        <div class="col-sm-6">
                          <input type="text" id="draftDetails" name="draftDetails" class="form-control" />
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="legalDetails">Legal Details</label>
                        <div class="col-sm-6">
                          <input type="text" id="legalDetails" name="legalDetails" class="form-control" />
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="documentDetails">Document Details</label>
                        <div class="col-sm-6">
                          <input type="text" id="documentDetails" name="documentDetails" class="form-control" />
                        </div>
                      </div>
                    </div> 


                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="legalBookDetails">LegalBook Details</label>
                        <div class="col-sm-6">
                          <input type="text" id="legalBookDetails" name="legalBookDetails" class="form-control" />
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="dtcpDetails">dtcp Details</label>
                        <div class="col-sm-6">
                          <input type="text" id="dtcpDetails" name="dtcpDetails" class="form-control" />
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="corporationDetails">Corporation Details</label>
                        <div class="col-sm-6">
                          <input type="text" id="corporationDetails" name="corporationDetails" class="form-control" />
                        </div>
                      </div>
                    </div>


                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="registrationDetails">Registration Details</label>
                        <div class="col-sm-6">
                          <input type="text" id="registrationDetails" name="registrationDetails" class="form-control" />
                        </div>
                      </div>
                    </div>

                

                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="agreementDocuments">agreement<br>Documents</label>
                        <div class="col-sm-5">
                          <div id="agreementDocumentsPath"></div>
                          <img id="agreementDocumentsPreview" src="" alt="" style="max-width: 100px; max-height: 100px; margin-top: 5px;">
            
                          <input class="form-control" type="file" id="agreementDocuments" name="agreementDocuments" />
                        </div>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <div class="form-group row">
                        <label class="col-sm-4 col-form-label" for="draftDocuments">draft<br>Documents</label>
                        <div class="col-sm-5">
                          <div id="draftDocumentsPath"></div>
                          <img id="draftDocumentsPreview" src="" alt="" style="max-width: 100px; max-height: 100px; margin-top: 5px;">
            
                          <input class="form-control" type="file" id="draftDocuments" name="draftDocuments" />
                        </div>
                      </div>
                    </div>

                      
                      <div class="col-md-4">
                        <div class="form-group row">
                          <label class="col-sm-4 col-form-label" for="legalDocuments">legal<br>Documents</label>
                          <div class="col-sm-5">
                            <div id="legalDocumentsPath"></div>
                            <img id="legalDocumentsPreview" src="" alt="" style="max-width: 100px; max-height: 100px; margin-top: 5px;">
              
                            <input class="form-control" type="file" id="legalDocuments" name="legalDocuments" />
                          </div>
                        </div>
                      </div>


                      <div class="col-md-4">
                        <div class="form-group row">
                          <label class="col-sm-4 col-form-label" for="documentDocuments">document<br>Documents</label>
                          <div class="col-sm-5">
                            <div id="documentDocumentsPath"></div>
                            <img id="documentDocumentsPreview" src="" alt="" style="max-width: 100px; max-height: 100px; margin-top: 5px;">
              
                            <input class="form-control" type="file" id="documentDocuments" name="documentDocuments" />
                          </div>
                        </div>
                      </div>
                      
                      <div class="col-md-4">
                        <div class="form-group row">
                          <label class="col-sm-4 col-form-label" for="legalBookDocuments">legalBook<br>Documents</label>
                          <div class="col-sm-5">
                            <div id="legalBookDocumentsPath"></div>
                            <img id="legalBookDocumentsPreview" src="" alt="" style="max-width: 100px; max-height: 100px; margin-top: 5px;">
              
                            <input class="form-control" type="file" id="legalBookDocuments" name="legalBookDocuments" />
                          </div>
                        </div>
                      </div>
  
                    
                      <div class="col-md-4">
                        <div class="form-group row">
                          <label class="col-sm-4 col-form-label" for="dtcpDocuments">dtcpDocuments<br>Preview</label>
                          <div class="col-sm-5">
                            <div id="dtcpDocumentsPath"></div>
                            <img id="dtcpDocumentsPreview" src="" alt="" style="max-width: 100px; max-height: 100px; margin-top: 5px;">
              
                            <input class="form-control" type="file" id="dtcpDocuments" name="dtcpDocuments" />
                          </div>
                        </div>
                      </div>
  
                      <div class="col-md-4">
                        <div class="form-group row">
                          <label class="col-sm-4 col-form-label" for="corporationDocuments" >corporation<br>Documents</label>
                          <div class="col-sm-5">
                            <div id="corporationDocumentsPath"></div>
                            <img id="corporationDocumentsPreview" src="" alt="" style="max-width: 100px; max-height: 100px; margin-top: 5px;">
              
                            <input class="form-control" type="file" id="corporationDocuments" name="corporationDocuments" />
                          </div>
                        </div>
                      </div>

                      <div class="col-md-4">
                        <div class="form-group row">
                          <label class="col-sm-4 col-form-label" for="layout">layout</label>
                          <div class="col-sm-5">
                            <div id="layoutPath"></div>
                            <img id="layoutPreview" src="" alt="" style="max-width: 100px; max-height: 100px; margin-top: 5px;">
              
                            <input class="form-control" type="file" id="layout" name="layout" />
                          </div>
                        </div>
                      </div>
  
  
                
                  </div>

                  <!-- Form buttons -->
                  <div class="d-flex justify-content-end">
                    <button type="submit" class="btn btn-gradient-primary me-2" value="submit">Submit</button>
                    <button type="button" class="btn btn-light" data-dismiss="modal" onclick="closeForm()">Cancel</button>
                  </div>

                </form>

              </div>
            </div>
          </div>
        </div>
        

        <!-- partial -->
        <div class="main-panel">
          <div class="content-wrapper">
            <div class="page-header" style="margin:2rem 0 1.5rem 0">
              <h3 class="page-title">Project List</h3>
              <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Project List</li>
                </ol>
              </nav>
            </div>
            <div class="row">

                <div class="col-lg-12 grid-margin stretch-card">
                    <div class="card">
                        <div class="card-body">
                            <div class="template-demo">
                                <button type="button" class="btn btn-gradient-danger btn-rounded btn-fw " onclick="window.location.href='project_masterForm.html';">Add New</button>
                            </div>
                            <div class="table-responsive">
                                <table id="dataTable" class="table table-hover">
                                    <thead>
                                        <tr>
                                          <th>Action</th>
                                          
                                            <th>Project Name</th>
                                            
                                            <th>Launch Date</th>
                                            <th>Company</th>
                                            <th>District</th>
                                            
                                            <th>Village</th>
                                            <th>Total Plot</th>
                                      
                                          
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Your table content -->
                                    </tbody>
                                </table>
                            </div>
                            <ul id="pagination" class="pagination"></ul>
                        </div>
                    </div>
                </div>
                
                
                  
            </div>
          </div>
          <!-- content-wrapper ends -->
            <!-- partial:../../partials/_footer.html -->
            <div id="includeFooder"></div>
            <!-- partial -->
        </div>
        <!-- main-panel ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
   
    <script>

function closeForm() {
        // Assuming 'employeeModal' is the ID of your modal
        $('#projectModal').modal('hide');
      }


      var formData = new FormData();
      const accessToken = localStorage.getItem('accessToken');
      $(document).ready(function () {
          $.ajax({
              url: 'http://localhost:8080/api/project/getAllProjectDetails',
              type: 'GET',
              dataType: 'json',
              headers: {
              'Content-Type': 'application/json',
              'Authorization': accessToken,
            },

              success: function (data) {
                  // Populate table with fetched data
                  $.each(data, function (index, project) {
                   

                      $('#dataTable tbody').append(`
                          <tr>
                              <td>
                                  <button type="button" class="btn btn-info btn-sm edit-btn edit-btn" data-toggle="modal"
                                  data-target="#projectModal" data-project-id="${project.id}">Edit</button>
                              </td>
                              <td>${project.projectName}</td>
                              <td>${project.launchDate}</td>
                              <td>${project.companyName}</td>
                              <td>${project.district}</td>
                              
                              <td>${project.village}</td>
                              <td>${project.totalPlots}</td>
                            

                          </tr>
                      `);
                  });
                  $('#projectModal').modal('hide');
              },
              error: function (xhr, status, error) {
                  console.error(xhr.responseText); // Log the error response
                  console.error(error); // Log the error message
                  showalert('Error fetching data from the server. Please try again later.'); // Display an error message to the user
              }
          });

          // Assuming you have an event listener for the edit buttons
          var currentProjectId;
          $(document).on('click', '.edit-btn', function () {
              currentProjectId = $(this).data('project-id');
              var projectId = $(this).data('project-id');
              const accessToken = localStorage.getItem('accessToken');
              $.ajax({
                  url: 'http://localhost:8080/api/project/getProjectById/' + projectId,
                  type: 'GET',
                  dataType: 'json',
                  headers: {
                  'Content-Type': 'application/json',
                  'Authorization': accessToken,
                  },
                  success: function (projectData) {
                      populateForm(projectData, formData);
                      document.body.scrollTop = 0; // For Safari
                      document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE, and Opera
                      $('#projectModal').modal('show');
                  },
                  error: function (xhr, status, error) {
                      console.error(xhr.responseText);
                      console.error(error);
                      showalert('Error fetching project details. Please try again later.');
                  }
              });
          });

          function populateForm(projectData, formData) {
console.log("projectDate for editing",projectData);
            const launchDateDate = new Date(projectData.launchDate);
    // Format the date to 'YYYY-MM-DD' (assuming you want this format)
    const formattedDate = launchDateDate.toISOString().split('T')[0];


              $('#companyName').val(projectData.companyName);
              $('#projectName').val(projectData.projectName);            
              $('#launchDate').val(formattedDate);             
             
              $('#landType').val(projectData.landType);
              $('#district').val(projectData.district);
              $('#taluk').val(projectData.taluk);
              $('#village').val(projectData.village);
               $('#extent').val(projectData.extent);
                $('#address').val(projectData.address);
              $('#geoLocation').val(projectData.geoLocation);
              $('#totalSiteSqft').val(projectData.totalSiteSqft);
              $('#totalSiteCent').val(projectData.totalSiteCent);
              $('#saleableSqft').val(projectData.saleableSqft);
              $('#saleableCent').val(projectData.saleableCent);
              $('#roadSqft').val(projectData.roadSqft);
              $('#roadCent').val(projectData.roadCent);
              $('#totalPlots').val(projectData.totalPlots);
          
              $('#eastDetails').val(projectData.eastDetails);
              $('#westDetails').val(projectData.westDetails );
              $('#northDetails').val(projectData.northDetails);
              $('#southDetails').val(projectData.southDetails);
              $('#prevOwnerName').val(projectData.prevOwnerName );
              $('#prevOwnerContact').val(projectData.prevOwnerContact);
              $('#prevOwnerAddress').val(projectData.prevOwnerAddress);
              $('#agreementDetails').val(projectData.agreementDetails);
              $('#draftDetails').val(projectData.draftDetails);
              $('#legalDetails').val(projectData.legalDetails);
              $('#documentDetails').val(projectData.documentDetails);
              $('#legalBookDetails').val(projectData.legalBookDetails);
              $('#dtcpDetails').val(projectData.dtcpDetails);
              $('#corporationDetails').val(projectData.corporationDetails);
              $('#registrationDetails').val(projectData.registrationDetails );
              
            
            
             
              const agreementDocumentsPreview = document.getElementById('agreementDocumentsPreview');

                
              if (agreementDocumentsPreview) {
                  // Display the avatar image using the File API
                  const agreementDocumentsFileInput = document.getElementById('agreementDocuments');
      
                  if (agreementDocumentsFileInput.files.length > 0) {
                      const reader = new FileReader();
      
                      reader.onload = function (e) {
                          console.log('Image loaded successfully');
                          agreementDocumentsPreview.src = e.target.result;
                      };
      
                      reader.readAsDataURL(agreementDocumentsFileInput.files[0]);
                  }
              }

               const draftDocumentsPreview = document.getElementById('draftDocumentsPreview');

                
              if (draftDocumentsPreview) {
                  // Display the avatar image using the File API
                  const draftDocumentsFileInput = document.getElementById('draftDocuments');
      
                  if (draftDocumentsFileInput.files.length > 0) {
                      const reader = new FileReader();
      
                      reader.onload = function (e) {
                          console.log('Image loaded successfully');
                          draftDocumentsPreview.src = e.target.result;
                      };
      
                      reader.readAsDataURL(draftDocumentsFileInput.files[0]);
                  }
              }


              const legalDocumentsPreview = document.getElementById('legalDocumentsPreview');

                
                if (legalDocumentsPreview) {
                     // Display the avatar image using the File API
                      const legalDocumentsFileInput = document.getElementById('legalDocuments');

                     if (legalDocumentsFileInput.files.length > 0) {
                  const reader = new FileReader();

                  reader.onload = function (e) {
                  console.log('Image loaded successfully');
                  legalDocumentsPreview.src = e.target.result;
                };

                reader.readAsDataURL(legalDocumentsFileInput.files[0]);
                }
          } 

              const documentDocumentsPreview = document.getElementById('documentDocumentsPreview');

                
              if (documentDocumentsPreview) {
                  // Display the avatar image using the File API
                  const documentDocumentsFileInput = document.getElementById('documentDocuments');
      
                  if (documentDocumentsFileInput.files.length > 0) {
                      const reader = new FileReader();
      
                      reader.onload = function (e) {
                          console.log('Image loaded successfully');
                          documentDocumentsPreview.src = e.target.result;
                      };
      
                      reader.readAsDataURL(documentDocumentsFileInput.files[0]);
                  }
              }

             const legalBookDocumentsPreview = document.getElementById('legalBookDocumentsPreview');

                
              if (legalBookDocumentsPreview) {
                  // Display the avatar image using the File API
                  const legalBookDocumentsFileInput = document.getElementById('legalBookDocuments');
      
                  if (legalBookDocumentsFileInput.files.length > 0) {
                      const reader = new FileReader();
      
                      reader.onload = function (e) {
                          console.log('Image loaded successfully');
                          legalBookDocumentsPreview.src = e.target.result;
                      };
      
                      reader.readAsDataURL(legalBookDocumentsFileInput.files[0]);
                  }
              }

              const corporationDocumentsPreview = document.getElementById('corporationDocumentsPreview');

                
              if (corporationDocumentsPreview) {
                  // Display the avatar image using the File API
                  const corporationDocumentsFileInput = document.getElementById('corporationDocuments');
      
                  if (corporationDocumentsFileInput.files.length > 0) {
                      const reader = new FileReader();
      
                      reader.onload = function (e) {
                          console.log('Image loaded successfully');
                          corporationDocumentsPreview.src = e.target.result;
                      };
      
                      reader.readAsDataURL(corporationDocumentsFileInput.files[0]);
                  }
              }

               const layoutPreview = document.getElementById('layoutPreview');

                
              if (layoutPreview) {
                  // Display the avatar image using the File API
                  const layoutFileInput = document.getElementById('layout');
      
                  if (layoutFileInput.files.length > 0) {
                      const reader = new FileReader();
      
                      reader.onload = function (e) {
                          console.log('Image loaded successfully');
                          layoutPreview.src = projectData.layout;
                          console.log(projectData.layout);
                      };
      
                      reader.readAsDataURL(layoutFileInput.files[0]);
                  }
              }
    
 }

 async function fetchCompanyIdByName(companyName) {
    try {
        const accessToken = localStorage.getItem('accessToken');
        const response = await fetch(`http://localhost:8080/api/company/getCompanyIdByCompanyName/${encodeURIComponent(companyName)}`, {
            headers: {
                'Content-Type': 'application/json',
                'Authorization': accessToken,
            },
        });

        if (!response.ok) {
            throw new Error('Failed to fetch companyId');
        }

        const company = await response.json();
        // Ensure the response structure matches what you expect
        return company.companyId; 

    } catch (error) {
        console.error('Error fetching companyId:', error);
        showalert('Failed to fetch companyId. Please try again.');
        return null;
    }
}


          document.getElementById('projectForm').addEventListener('submit', async function (event) {
              event.preventDefault();
              const companyName = document.getElementById('companyName').value; // Retrieve companyName from input field
    const companyId = await fetchCompanyIdByName(companyName); 
    console.log("id",companyId);// Fetch companyId based on companyName

    if (companyId === null) {
        showalert('Invalid companyName or companyId not found.');
        return;
    }

              const formData = new FormData();

              var projectId = currentProjectId;

                      const projectData = {
                        companyName: document.getElementById('companyName').value,

                        companyId: companyId, // Use the fetched companyId
                        projectName: document.getElementById('projectName').value,
                        launchDate: document.getElementById('launchDate').value,

                         landType: document.getElementById('landType').value,

                        district: document.getElementById('district').value,

                        taluk: document.getElementById('taluk').value,

                        village: document.getElementById('village').value,

                       extent: document.getElementById('extent').value,

                        address: document.getElementById('address').value,

                        geoLocation: document.getElementById('geoLocation').value,

                        totalSiteSqft: document.getElementById('totalSiteSqft').value,

                        totalSiteCent: document.getElementById('totalSiteCent').value,

                        saleableSqft: document.getElementById('saleableSqft').value,

                        saleableCent: document.getElementById('saleableCent').value,

                        roadSqft: document.getElementById('roadSqft').value,

                        roadCent: document.getElementById('roadCent').value,

                        totalPlots: document.getElementById('totalPlots').value,
                        
                        eastDetails: document.getElementById('eastDetails').value,

                        westDetails: document.getElementById('westDetails').value,

                        northDetails: document.getElementById('northDetails').value,

                        southDetails: document.getElementById('southDetails').value,

                        prevOwnerName: document.getElementById('prevOwnerName').value,

                        prevOwnerContact: document.getElementById('prevOwnerContact').value,

                        prevOwnerAddress: document.getElementById('prevOwnerAddress').value,

                        agreementDetails: document.getElementById('agreementDetails').value,

                        draftDetails: document.getElementById('draftDetails').value,

                        legalDetails: document.getElementById('legalDetails').value,

                        documentDetails: document.getElementById('documentDetails').value,

                        legalBookDetails: document.getElementById('legalBookDetails').value,

                        dtcpDetails: document.getElementById('dtcpDetails').value,

                        corporationDetails: document.getElementById('corporationDetails').value,

                        registrationDetails: document.getElementById('registrationDetails').value,

                      };



                      // Convert employeeData to JSON and append to formData

                      formData.append('project', new Blob([JSON.stringify(projectData)], { type: 'application/json' }));



                      const agreementDocumentsFileInput = document.getElementById('agreementDocuments');

                      if (agreementDocumentsFileInput.files.length > 0) {

                        // Append avatar file to formData

                        formData.append('agreementDocuments', agreementDocumentsFileInput.files[0]);

                      }

                      const draftDocumentsFileInput = document.getElementById('draftDocuments');

                      if (draftDocumentsFileInput.files.length > 0) {

                        // Append avatar file to formData

                        formData.append('draftDocuments', draftDocumentsFileInput.files[0]);

                      }

                      const legalDocumentsFileInput = document.getElementById('legalDocuments');

                      if (legalDocumentsFileInput.files.length > 0) {

                        // Append avatar file to formData

                        formData.append('legalDocuments', legalDocumentsFileInput.files[0]);

                      }

                      const documentDocumentsFileInput = document.getElementById('documentDocuments');

                      if (documentDocumentsFileInput.files.length > 0) {

                        // Append avatar file to formData

                        formData.append('documentDocuments', documentDocumentsFileInput.files[0]);

                      }

                     const legalBookDocumentsFileInput = document.getElementById('legalBookDocuments');

                      if (legalBookDocumentsFileInput.files.length > 0) {

                        // Append avatar file to formData

                        formData.append('legalBookDocuments', legalBookDocumentsFileInput.files[0]);

                      }

                      const dtcpDocumentsFileInput = document.getElementById('dtcpDocuments');

                        if (dtcpDocumentsFileInput.files.length > 0) {

                              // Append avatar file to formData

                              formData.append('dtcpDocuments', dtcpDocumentsFileInput.files[0]);

                    }  

                    
                    const corporationDocumentsFileInput = document.getElementById('corporationDocuments');

                        if (corporationDocumentsFileInput.files.length > 0) {

                     // Append avatar file to formData
     
                         formData.append('corporationDocuments', corporationDocumentsFileInput.files[0]);

                         }

                         const layoutFileInput = document.getElementById('layout');

                        if (layoutFileInput.files.length > 0) {

                     // Append avatar file to formData
     
                         formData.append('layout', layoutFileInput.files[0]);

                         }

              const accessToken = localStorage.getItem('accessToken');
              $.ajax({
                  url: 'http://localhost:8080/api/project/updateProject/' + currentProjectId,
                  type: 'PUT',
                  data: formData,
                  headers: {
                
                  'Authorization': accessToken,
                  },
                  processData: false,
                  contentType: false,
                  success: function (response) {
                      console.log('Project updated successfully:', response);
                      
                      showalert('Project Details updated successfully',function(){
                      window.location.href = "project_masterList.html";
                      });
                  },
                  error: function (xhr, status, error) {
                      console.error('Error updating project:', error);
                      showalert('Error updating project. Please try again.');
                  }
              });
          });
      });

      $(document).ready(function(){
  $('#prevOwnerContact').on('input', function(){
      var phoneNumber = $(this).val();
      
      // Check if the input contains letters or special characters
      if(/[^\d]/.test(phoneNumber)) {
          showalert('Please enter digits only.');
          phoneNumber = phoneNumber.replace(/[^\d]/g, '');
      }

      // Remove any non-digit characters
      phoneNumber = phoneNumber.replace(/\D/g,'');

      // Limit to 12 digits
      if(phoneNumber.length > 12){
          showalert('Please enter a maximum of 12 digits.');
          phoneNumber = phoneNumber.substr(0, 12);
      }

      $(this).val(phoneNumber);
  });
});

                    $(document).ready(function(){
                      $('#companyName,#projectName,#district,#prevOwnerName').on('input', function(){
                          var inputValue = $(this).val();
                          // Check if the input contains any numeric characters
                          if(/\d/.test(inputValue)){
                              showalert('Please enter alphabetic characters only.');
                              // Remove the numeric characters
                              $(this).val(inputValue.replace(/\d/g, ''));
                          }
                          if(/[^\w\s]/.test(inputValue)){
                            showalert('Special characters are not allowed.');
                            // Remove the special characters
                            $(this).val(inputValue.replace(/[^\w\s]/g, ''));
                        }
                        // Check if the input length exceeds the limit
                        if(inputValue.length > 50){
                            showalert('Maximum length exceeded. Please enter up to 50 characters.');
                            // Trim the input to the maximum length
                            $(this).val(inputValue.slice(0, 50));
                        }
                      });
                    });
                    $(document).ready(function(){
    $('#extent,#totalSiteSqft,#totalSiteCent,#saleableSqft,#saleableCent,#roadSqft,#roadCent,#totalPlots').on('input', function(){
        var inputText = $(this).val();
        
        // Check if input contains letters, special characters, or more than 20 digits
        if(/[^\d]/.test(inputText)) {
            showalert('Please enter digits only.');
            inputText = inputText.replace(/[^\d]/g, '');
        }
        
        // Remove any non-numeric characters and extra digits
        inputText = inputText.replace(/\D/g, '').substr(0, 20);

        $(this).val(inputText);
    });
});

                    
                    function validateNo(event) {
    const inputValue = event.target.value;
    const NoRegex = /^[A-Za-z0-9]*$/; // Regular expression to allow only alphabets and numbers

    if (!NoRegex.test(inputValue)) {
      showalert("Please enter numbers and alphabets only.");
      event.target.value = ''; // Clear the input field
    }
  }

                    $(document).ready(function(){
                      $('#village,#landType,#newSurveyNo,#address,#geoLocation,#eastDetails,#westDetails,#northDetails,#southDetails,#prevOwnerAddress,#agreementDetails,#draftDetails,#legalDetails,#documentDetails,#legalBookDetails,#dtcpDetails,#corporationDetails,#registrationDetails').on('input', function(){
                          var inputValue = $(this).val();
                          // Check if the input contains any numeric characters
                         
                          
                        // Check if the input length exceeds the limit
                        if(inputValue.length > 50){
                            showalert('Maximum length exceeded. Please enter up to 50 characters.');
                            // Trim the input to the maximum length
                            $(this).val(inputValue.slice(0,50));
                            
                        }
                      });
                    });
                    function logout() {
                      // Clear local storage
                      localStorage.clear();
                      
                      // Redirect to the logout page or perform other logout actions
                      window.location.href = '../../index.html';
                  }      

  </script>






    
    <!-- plugins:js -->
  <script src="../../assets/vendors/js/vendor.bundle.base.js"></script></script>
 */
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="../../assets/vendors/chart.js/Chart.min.js"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="../../assets/js/off-canvas.js"></script>
    <script src="../../assets/js/hoverable-collapse.js"></script>
    <!-- <script src="../../assets/js/pagination.js"></script> -->  
    <script src="../../assets/js/menu_active.js"></script>
    <script src="../../assets/js/misc.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="../../assets/js/chart.js"></script>
    <!-- End custom js for this page -->
    <!-- End custom js for this page -->
  </body>
</html>