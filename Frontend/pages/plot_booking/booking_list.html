<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Book List | Aishalaya</title>
  <link rel="shortcut icon" href="../../assets/images/aishLogo.ico" />

  <!-- plugins:css -->
  <link rel="stylesheet" href="../../assets/vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="../../assets/vendors/css/vendor.bundle.base.css">
  <!-- endinject -->
  <!-- Plugin css for this page -->
  <!-- End Plugin css for this page -->
  <!-- inject:css -->
  <!-- endinject -->
  <!-- Layout styles -->
  <link rel="stylesheet" href="http://127.0.0.1:5500/assets/css/style.css">
 
  <!-- End layout styles -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
  <!--<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">-->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <!--<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>-->
  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>-->
  <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>-->
 <!--showalert Message-->
 <script src="http://127.0.0.1:5500/assets/js/alertMessages.js"></script>
 
   
 <style>
    /* Adjust the modal size */
    .modal-dialog {
      max-width: 1400px;
      /* Set your desired maximum width */
    }

    /* Adjust the form size */
    .form-sample {
      max-width: 100%;
      /* Set your desired maximum width */
    }

    @media (min-width: 576px) {
      .col-sm-9 {
        -webkit-box-flex: 0;
        -ms-flex: 0 0 auto;
        flex: 0 0 auto;
        width: 60% !important;
      }
    }
  </style>
</head>

<body>
  <div class="container-scroller">

    <!-- partial:../../partials/_navbar.html -->
    <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
        <a class="navbar-brand brand-logo" href="/pages/dashboard/dashboard.html"><img
            src="../../assets/images/logo.png" alt="logo" style="height: 100%;" /></a>
        <a class="navbar-brand brand-logo-mini" href="/pages/dashboard/dashboard.html"><img
            src="../../assets/images/logo.png" alt="logo" style="height: 100%;" /></a>
      </div>
      <div class="navbar-menu-wrapper d-flex align-items-stretch">
        <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
          <span class="mdi mdi-menu"></span>
        </button>
        <ul class="navbar-nav navbar-nav-right">
          <li class="nav-item d-none d-lg-block full-screen-link">
            <a class="nav-link">
              <i class="mdi mdi-fullscreen" id="fullscreen-button"></i>
            </a>
          </li>
          <li class="nav-item nav-logout d-none d-lg-block">
            <a class="nav-link" onclick="logout()">
              <i class="mdi mdi-power"></i>
            </a>
          </li>
        </ul>
        <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button"
          data-toggle="offcanvas">
          <span class="mdi mdi-menu"></span>
        </button>
      </div>
    </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <!-- partial:../../partials/_sidebar.html -->
      <div id="includeHtml"></div>


      <!-- Company Form-->
      <div class="modal fade" id="companyModal" tabindex="-1" role="dialog" aria-labelledby="companyModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="companyModalLabel">Block Details</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="closeForm()">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>

            <div class="modal-body">
              <div class="row">
                <div class="col-5 offset-md-1 grid-margin stretch-card">
                  <div class="card">
                    <div class="card-body">
                      <h4 class="card-title">CUSTOMER DETAILS :</h4>

                      <form id="customerForm" class="forms-sample">
                        <div class="form-group row">
                          <label for="customerName" class="col-sm-4 col-form-label"
                            style="margin-top: 30px;">Name</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="customerName" placeholder="Name"
                              style="margin-top: 30px;">
                          </div>
                        </div>
                        <div class="form-group row">
                          <label for="mobileNumber" class="col-sm-4 col-form-label">Mobile
                            Number</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="mobileNumber" placeholder="mobileNumber">
                          </div>
                        </div>

                        <div class="form-group row">
                          <label for="employeeType" class="col-sm-4 col-form-label">Occupation</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="employeeType" placeholder="occupation">
                          </div>
                        </div>
                        <div class="form-group row">
                          <label for="workPlace" class="col-sm-4 col-form-label">Work
                            Place</label>
                          <div class="col-sm-9">
                            <input type="workPlace" class="form-control" id="workPlace" placeholder="workPlace">
                          </div>
                        </div>


                        <div class="form-group row">
                          <label for="address" class="col-sm-4 col-form-label">Address
                            :</label>
                          <div class="col-sm-9">
                            <textarea class="form-control" id="address" rows="3" placeholder="address"
                              style="width: 99%;"></textarea>
                          </div>

                        </div>
                        <div class="form-group row">
                          <label for="email" class="col-sm-4 col-form-label">Email
                            :</label>
                          <div class="col-sm-8 input-group" d-flex>
                            <input type="email" class="form-control" id="email" placeholder="email">
                            <div class="input-group-append">
                              <a href="mailto:recipient@example.com?subject=Subject%20Here&body=Body%20of%20the%20email"
                                class="btn btn-primary">Compose</a>
                            </div>
                          </div>
                        </div>

                      </form>
                    </div>
                  </div>
                </div>
                <div class="col-md-5  grid-margin stretch-card">
                  <div class="card">
                    <div class="card-body">
                      <h4 class="card-title">VISIT DETAILS :</h4>


                      <form id="companyForm" class="forms-sample">
                        <div class="form-group row">
                          <label for="cab" class="col-sm-4 col-form-label" style="margin-top: 30px;">Cab</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="cab" placeholder="cab" name="cab"
                              style="margin-top: 30px;">
                          </div>
                        </div>
                        <div class="form-group row">
                          <label for="driver" class="col-sm-4 col-form-label">Driver</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="driver" placeholder="Driver" name="driver">
                          </div>
                        </div>
                        <div class="form-group row">
                          <label for="startingKms" class="col-sm-4 col-form-label">Starting
                            Kms</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="startingKms" placeholder="startingKms"
                              name="startingKms">
                          </div>
                        </div>

                        <div class="form-group row">
                          <label for="endKms" class="col-sm-4 col-form-label">Ending
                            Kms</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="endKms" placeholder="endKms" name="endKms">
                          </div>
                        </div>
                        <div class="form-group row">
                          <label for="employeeNotes" class="col-sm-4 col-form-label">Employee
                            Notes</label>

                          <div class="col-sm-9">
                            <textarea class="form-control" id="employeeNotes" rows="3" placeholder="employeeNotes"
                              style="width: 99%;" name="employeeNotes"></textarea>
                          </div>

                        </div>
                      </form>
                    </div>
                  </div>
                </div>


              </div>

              <!-- Company Form -->
              <div class="row">
                <div class="col-md-5 offset-md-1 grid-margin stretch-card">
                  <div class="card">
                    <div class="card-body">
                      <h4 class="card-title">EMPLOYEE DETAILS :</h4>

                      <form class="forms-sample">
                        <div class="form-group row">
                          <label for="employeeName" class="col-sm-4 col-form-label" style="margin-top: 30px;">Employee
                            Name</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="employeeName"
                              placeholder="projectNamecompanyName" style="margin-top: 30px;">
                          </div>
                        </div>


                        <div class="form-group row">
                          <label for="alterMobile" class="col-sm-4 col-form-label">Mobile</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="alterMobile" placeholder="Address">
                          </div>
                        </div>

                        <div class="form-group row">
                          <label for="createdBy" class="col-sm-4 col-form-label">Created
                            By</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="createdBy" placeholder="Password">
                          </div>
                        </div>
                        <div class="form-group row">
                          <label for="prefLocation" class="col-sm-4 col-form-label">Location</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="prefLocation" placeholder="launchDate">
                          </div>
                        </div>
                        <div class="form-group row">
                          <label for="employeeEmail" class="col-sm-4 col-form-label">Email
                            :</label>
                          <div class="col-sm-8 input-group" d-flex>
                            <input type="email" class="form-control" id="employeeEmail" placeholder="email"
                              style="width: 10%;">
                            <div class="input-group-append">
                              <a href="mailto:recipient@example.com?subject=Subject%20Here&body=Body%20of%20the%20email"
                                class="btn btn-primary">Compose</a>
                            </div>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>

              </div>

            </div>
          </div>
        </div>
      </div> <!-- partial -->

      <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editModalLabel">Edit Paid Amount</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="editForm">


                <input type="hidden" id="bookingIdInput"> 
                <input type="hidden" id="balanceUpdation">
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group row">
                      <label class="col-sm-9 col-form-label" for="customerNameInEditForm">Customer Name</label>
                      <div class="col-sm-9">
                        <input class="form-control" type="text" id="customerNameInEditForm"
                          name="customerNameInEditForm" placeholder="customerName" />
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group row">
                      <label class="col-sm-9 col-form-label" for="mobileNumberInEditForm">Mobile Number</label>
                      <div class="col-sm-9">
                        <input class="form-control" type="text" id="mobileNumberInEditForm"
                          name="mobileNumberInEditForm" placeholder="mobile Number" />
                      </div>
                    </div>
                  </div>

                  <div class="col-md-4">
                    <div class="form-group row">
                      <label class="col-sm-9 col-form-label" for="projectInEditForm">Project</label>
                      <div class="col-sm-9">
                        <input class="form-control" type="text" id="projectInEditForm" name="projectInEditForm"
                          placeholder="project" />
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group row">
                      <label class="col-sm-9 col-form-label" for="plotNumberInEditForm">Plot number</label>
                      <div class="col-sm-9">
                        <input class="form-control" type="text" id="plotNumberInEditForm" name="plotNumberInEditForm"
                          placeholder="plotNumber" />
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group row">
                      <label class="col-sm-9 col-form-label" for="paidAmountInEditForm">Paid Amount â‚¹ <span class="text-danger">*</span></label>
                      <div class="col-sm-9">
                        <input class="form-control" type="text" id="paidAmountInEditForm" name="paidAmountInEditForm"
                          placeholder="paid Amount" />
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group row">
                      <label class="col-sm-9 col-form-label" for="paidDateInEditForm">Paid Date</label>
                      <div class="col-sm-9">
                        <input class="form-control" type="date" id="paidDateInEditForm" name="paidDateInEditForm" />
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group row">
                      <label class="col-sm-9 col-form-label" for="paymentTypeInEditForm">Payment Type</label>
                      <div class="col-sm-9">
                        <select class="form-control" id="paymentTypeInEditForm" name="paymentTypeInEditForm">
                          <option value="" disabled selected>Select Payment Type</option>
                          <option value="Credit Card">Credit Card</option>
                          <option value="Debit Card">Debit Card</option>
                          <option value="Cash">Cash</option>
                          <option value="Bank Transfer">Bank Transfer</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group row">
                      <label class="col-sm-9 col-form-label" for="paymentModeInEditForm">Payment Mode</label>
                      <div class="col-sm-9">
                        <select class="form-control" id="paymentModeInEditForm" name="paymentModeInEditForm">
                          <option value="" disabled selected>Select Payment Mode</option>
                          <option value="Part Payment">Part Payment</option>
                          <option value="Full Payment">Full Payment</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group row">
                      <label class="col-sm-9 col-form-label" for="paidByInEditForm">Paid By</label>
                      <div class="col-sm-9">
                        <input class="form-control" type="text" id="paidByInEditForm" name="paidByInEditForm"
                          placeholder="Paid By" />
                      </div>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group row">
                      <label class="col-sm-9 col-form-label" for="receivedByInEditForm">Received By</label>
                      <div class="col-sm-9">
                        <input class="form-control" type="text" id="receivedByInEditForm" name="receivedByInEditForm"
                          placeholder="Received By" />
                      </div>
                    </div>
                  </div>

                  <div id="denominationTableContainer" style="display: none;" class="row">
                    <h5>Denomination</h5>
                    <div class="table-responsive">
                      <table class="table table-striped">
                        <thead>
                          <tr>
                            <th>S.no</th>
                            <th>Rupees</th>
                            <th>No.of.Notes</th>
                            <th>Total Amount</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>1</td>
                            <td>500</td>
                            <td><input class="form-control" type="text" name="row1col3" id="row1col3"></td>
                            <td><input class="form-control" type="text" name="row1col4" id="row1col4" readonly>
                            </td>
                          </tr>
                          <tr>
                            <td>2</td>
                            <td>200</td>
                            <td><input class="form-control" type="text" name="row2col3" id="row2col3"></td>
                            <td><input class="form-control" type="text" name="row2col4" id="row2col4"></td>
                          </tr>
                          <tr>
                            <td>3</td>
                            <td>100</td>
                            <td><input class="form-control" type="text" name="row3col3" id="row3col3"></td>
                            <td><input class="form-control" type="text" name="row3col4" id="row3col4"></td>
                          </tr>
                          <tr>
                            <td>4</td>
                            <td>50</td>
                            <td><input class="form-control" type="text" name="row4col3" id="row4col3"></td>
                            <td><input class="form-control" type="text" name="row4col4" id="row4col4"></td>
                          </tr>
                          <tr>
                            <td>5</td>
                            <td>20</td>
                            <td><input class="form-control" type="text" name="row5col3" id="row5col3"></td>
                            <td><input class="form-control" type="text" name="row5col4" id="row5col4"></td>
                          </tr>
                          <tr>
                            <td>6</td>
                            <td>10</td>
                            <td><input class="form-control" type="text" name="row6col3" id="row6col3"></td>
                            <td><input class="form-control" type="text" name="row6col4" id="row6col4"></td>
                          </tr>
                          <tr>
                            <td></td>
                            <td>Total</td>
                            <td><input class="form-control" type="text" name="denoTotalNotes" id="denoTotalNotes"></td>
                            <td><input class="form-control" type="text" name="denoTotalAmount" id="denoTotalAmount">
                            </td>
                          </tr>

                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div id="BankTableContainer" style="display:none;" class="row">
                    <h5>Bank Details :

                    </h5>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group row">
                          <label class="col-sm-5 col-form-label" for="bankName">Bank Name</label>
                          <div class="col-sm-5">
                            <input class="form-control" type="text" id="bankName" name="bankName" />
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group row">
                          <label class="col-sm-5 col-form-label" for="cdtNo">Cheque / DD No / Transaction
                            ID</label>
                          <div class="col-sm-5">
                            <input class="form-control" type="text" id="cdtNo" name="cdtNo" />
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group row">
                        <label class="col-sm-5 col-form-label" for="cdtDate">
                          Date</label>
                        <div class="col-sm-5">
                          <input class="form-control" type="date" id="cdtDate" name="cdtDate" />
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="btn-group">
                    <div class="col">
                      <button type="button" id="toggleTableBtnDenomination" class="btn btn-sm btn btn-primary"
                        onclick="toggleDenominationTable()">Cash Denomination Table</button>

                      <button type="button" id="toggleTableBtnCardTransaction" class="btn btn-sm btn btn-primary"
                        onclick="toggleCardTransactionTable()">card Denomination Table</button>
                    </div>
                  </div>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" id="saveEditBtn">Submit Payment</button>
            </div>
          </div>
        </div>
      </div>


      <div class="main-panel">
        <div class="content-wrapper">
          <h3 class="page-title">BOOK LIST </h3><br />

          <div class="page-header">
            <!--<h3 class="page-title">Site Visit List</h3><br/>-->

            <nav aria-label="breadcrumb">
              <ol class="breadcrumb">
                <button class="btn btn-info btn-sm edit-btn" id="filterButton">Filter</button>
                <div id="filterFields" style="display: none;">
                  <div class="row">
                    <div class="col">
                      <input type="date" class="form-control" aria-label="From Date" id="fromDate">
                    </div>
                    <div class="col">
                      <input type="date" class="form-control" aria-label="To Date" id="toDate" placeholder="To">
                    </div>
                    <div class="col">
                      <input type="text" class="form-control" aria-label="mobile" id="mobile" placeholder="Mobile No">
                    </div>
                    <div class="col">
                      <input type="text" class="form-control" aria-label="filtercustomerNames" id="filtercustomerNames"
                        placeholder="customerNames">
                    </div>
                    <div class="col">
                      <input type="text" class="form-control" aria-label="filterEmployeeNames" id="filterEmployeeNames"
                        placeholder="EmployeeName">
                    </div>



                    <!--   <div class="col">
                                            <input type="text" class="form-control" aria-label="buyingDurationFilter"
                                                id="buyingDurationFilter" placeholder="Buying Duration">
                                        </div>
                                        <div class="col">
                                            <input type="text" class="form-control" aria-label="fundingResourceFilter"
                                                id="fundingResourceFilter" placeholder="fundingResourceFilter">
                                        </div>-->
                    <div class="col">
                      <input type="text" class="form-control" placeholder="Search..." aria-label="Search"
                        aria-describedby="search-button" id="searchInput">
                    </div>
                    <div class="col">
                      <button class="btn btn-outline-secondary" type="button" id="search-button">Search</button>
                    </div>

                  </div>
                </div>


              </ol>

            </nav>
          </div>
          <div class="row">

            <div class="col-lg-12 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <div class="template-demo">

                  </div>
                  <div class="table-responsive">
                    <table id="dataTable" class="table table-hover">
                      <thead>
                        <tr>
                          <th>Date</th>
                          <th>ID</th>
                          <th>Customer Mobile</th>
                          <th>Project</th>
                          <th>PlotNumber</th>
                          <th>NetAmount</th>
                          <th>Total Paid</th>
                          <th>Balance</th>
                          <th>Actions</th>

                        </tr>
                      </thead>
                      <tbody>
                        <!-- Your table content -->
                      </tbody>
                    </table>
                  </div>
                  <ul id="pagination" class="pagination"></ul>
                </div>
              </div>
            </div>



          </div>
        </div>
        <!-- content-wrapper ends -->
        <div id="includeFooder"></div>
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->

  <!-- plugins:js -->
  <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>-->
  <!--  -->

  <!-- Your custom JavaScript code here -->

  <div class="container-fluid page-body-wrapper">
    <div id="includeHtml"></div>


    <script>
function logout() {
    // Clear local storage
    localStorage.clear();

    // Replace current state with a new state to prevent going back
    window.history.replaceState(null, "", window.location.href);

    // Add an event listener to handle the popstate event
    window.onpopstate = function (event) {
        // Push another state to forward the user
        window.history.pushState(null, "", window.location.href);
    };

    // Redirect to the logout page or perform other logout actions
    window.location.href = '../../index.html';
   }
      function logout() {
        // Clear local storage
        localStorage.clear();

        // Redirect to the logout page or perform other logout actions
        window.location.href = '../../index.html';
      }

      $(document).ready(function () {
        $('#mobileNumber,#phoneNumber').on('input', function () {
          var phoneNumber = $(this).val();

          // Check if the input contains letters or special characters
          if (/[^\d]/.test(phoneNumber)) {
            showalert('Please enter digits only.');
            phoneNumber = phoneNumber.replace(/[^\d]/g, '');
          }

          // Remove any non-digit characters
          phoneNumber = phoneNumber.replace(/\D/g, '');

          // Limit to 12 digits
          if (phoneNumber.length > 12) {
            showalert('Please enter a maximum of 12 digits.');
            phoneNumber = phoneNumber.substr(0, 12);
          }

          $(this).val(phoneNumber);
        });
      });

      $(document).ready(function () {
        $('#customerName, #customerName1,#city,#district,#state,#driver,#area,#workPlace').on('input', function () {
          var inputValue = $(this).val();
          // Check if the input contains any numeric characters
          if (/\d/.test(inputValue)) {
            showalert('Please enter alphabetic characters only.');
            // Remove the numeric characters
            $(this).val(inputValue.replace(/\d/g, ''));
          }
          if (/[^\w\s]/.test(inputValue)) {
            showalert('Special characters are not allowed.');
            // Remove the special characters
            $(this).val(inputValue.replace(/[^\w\s]/g, ''));
          }
          // Check if the input length exceeds the limit
          if (inputValue.length > 100) {
            showalert('Maximum length exceeded. Please enter up to 50 characters.');
            // Trim the input to the maximum length
            $(this).val(inputValue.slice(0, 50));
          }
        });
      });

      const emailInput = document.getElementById('email');
      const validationMessage = document.getElementById('validationMessage');
      // Regular expression to validate email addresses for the specified domains
      const emailRegex = /^[a-zA-Z0-9._%+-]+@(gmail\.com|yahoo\.com|outlook\.com|hotmail\.com|aol\.com|icloud\.com|protonmail\.com|zoho\.com|gmx\.com|yandex\.com|mail\.com)$/;

      emailInput.addEventListener('input', validateEmail);

      function validateEmail() {
        const email = emailInput.value;

        if (emailRegex.test(email)) {
          validationMessage.innerText = "Valid email address";
          validationMessage.style.color = "green";
        } else {
          validationMessage.innerText = "Invalid email address";
          validationMessage.style.color = "red";
        }
      }

      $(document).ready(function () {
        $('#startingKms,#endKms').on('input', function () {
          var startingKms = $(this).val();
          // Check if input contains any non-numeric or non-decimal characters
          if (/[^0-9.]/.test(startingKms)) {
            showalert('Please enter numbers only.');
            // Remove non-numeric and non-decimal characters
            startingKms = startingKms.replace(/[^0-9.]/g, '');
            $(this).val(startingKms);
          }
        });
      });

      $(document).ready(function () {
        $('#postalCode').on('input', function () {
          var postalCode = $(this).val();
          // Check if input contains non-numeric characters or more than 6 digits
          if (/\D/.test(postalCode) || postalCode.length > 6) {
            showalert('Please enter exactly 6 digits.');
            // Remove non-numeric characters and extra digits
            postalCode = postalCode.replace(/\D/g, '').substr(0, 6);
            $(this).val(postalCode);
          }
        });
      });

      $(document).ready(function () {
        $('#location,#address,#streetName').on('input', function () {
          var inputValue = $(this).val();
          // Check if the input contains any numeric characters

          // Check if the input length exceeds the limit
          if (inputValue.length > 100) {
            showalert('Maximum length exceeded. Please enter up to 50 characters.');
            // Trim the input to the maximum length
            $(this).val(inputValue.slice(0, 100));
          }
        });
      });

      function validateNo(event) {
        const inputValue = event.target.value;
        const NoRegex = /^[A-Za-z0-9]*$/; // Regular expression to allow only alphabets and numbers

        if (!NoRegex.test(inputValue)) {
          showalert("Please enter numbers and alphabets only.");
          event.target.value = ''; // Clear the input field
        }
      }

      function closeForm() {
        // Assuming 'employeeModal' is the ID of your modal

        $('#companyModal').modal('hide');
      }
      var formData = new FormData();



      jQuery(document).ready(function ($) {


        $('#filterButton').click(function () {
          $('#filterFields').toggle();
        });

        function redirectToBlockPage(visitDetailId) {
          // Construct the URL with the visitDetailId parameter
          const url = `block_details.html?id=${visitDetailId}`;
          // Redirect to the new URL
          window.location.href = url;
        }

        $(document).on('click', '.change-btn', function () {

          var visiterId = $(this).data('company-id');
          var phoneNo = $(this).data('phone-number');
          var project = $(this).data('project-name');
          var bookingId = $(this).data('booking-id')
          console.log(bookingId);
          window.location.href = `bookingChange.html?id=${visiterId}&phoneNumber=${phoneNo}&projectName=${project}&bookingId=${bookingId}`;
        });

        $(document).on('click', '.cancel-btn', function () {

          var visiterId = $(this).data('company-id');
          var phoneNo = $(this).data('phone-number');
          var project = $(this).data('project-name');
          console.log(phoneNo, project);
          window.location.href = `bookingCancel.html?id=${visiterId}&phoneNumber=${phoneNo}&projectName=${project}`;
        });
        $(document).on('click', '.edit-btn', function () {
          var bookingId = $(this).data('booking-id');
          var balanceUpdated =$(this).data('booking-balance');
          $('#bookingIdInput').val(bookingId);
           editFunction(bookingId);
          $('#editModal').modal('show');
        });



        var accumulatedData = [];


        function fetchVisitDetails(mobile, startDate, endDate, employeeNames, customerNames) {
          // Fetch data by date range
          accumulatedData = [];
          var requests = [];


          if (startDate && endDate) {
            requests.push($.ajax({
              url: `http://localhost:8080/getByDateRangeInBookingDetails?startDate=${startDate}&endDate=${endDate}`,
              type: 'GET',
              dataType: 'json',
              success: function (dateRangeData) {
                console.log("1");
                accumulateData(dateRangeData);
                console.log("getByDateRange9999999999999", accumulateData);

              },
              error: function (xhr, status, error) {
                console.error(xhr.responseText);
                console.error(error);
                // Handle error for date range data
              }
            }));
          }
          // Fetch data by date range
          if (mobile) {
            requests.push($.ajax({
              url: 'http://localhost:8080/getByPhoneNumbersInBookingDetails',
              type: 'GET',
              dataType: 'json',
              data: { phoneNumber: mobile },
              success: function (phoneNumberData) {
                console.log("hi");
                accumulateData(phoneNumberData);


              },
              error: function (xhr, scustomeridtatus, error) {
                console.error('Error in getByPhoneNumbers AJAX request:');
                console.error(xhr.responseText);
                console.error(error);
                // Handle error for phone number data
              }
            }));
          }
          if (employeeNames) {
            // Fetch data by date range
            requests.push($.ajax({
              url: `http://localhost:8080/getByEmployeeNamesInBookingDetails`,
              type: 'GET',
              dataType: 'json',
              data: { employeeName: employeeNames },
              success: function (employeedata) {
                accumulateData(employeedata);

              },
              error: function (xhr, status, error) {
                console.error(xhr.responseText);
                console.error(error);
                // Handle error for phone number data
              }
            }));
          }
          if (customerNames) {
            requests.push($.ajax({
              url: `http://localhost:8080/getByCustomerNamesInBookingDetails`,
              type: 'GET',
              dataType: 'json',
              data: { customerName: customerNames },
              success: function (customerdata) {
                accumulateData(customerdata);
              },
              error: function (xhr, status, error) {
                console.error(xhr.responseText);
                console.error(error);
                // Handle error for phone number data
              }
            }));
          }

          $.when.apply($, requests).then(function () {
            // Collect data from all responses
            $.each(arguments, function (index, responseData) {
              accumulateData(responseData[0]);
            });
            // Apply filters after all AJAX requests have completed
            applyFilters();
          });
          function accumulateData(data) {
            // Combine the new data with the accumulated data
            accumulatedData = accumulatedData.concat(data);

            applyFilters();
            // Apply filters to the accumulated data

          }
          function applyFilters() {
            // Apply filters to the accumulated data and update the table
            var filteredData = accumulatedData.filter(item => typeof item === 'object' && item !== undefined && item !== null);

            // Check if there are any filtered results
            if (filteredData.length === 0) {
              // If no results, clear the table body
              var tableBody = $('#dataTable tbody');
              tableBody.empty();
              return;
            }
            var encounteredPhoneNumbers = new Set();
            console.log("Accumulated data:", accumulatedData);
            console.log("Filtered data before filtering:", filteredData);


            var filteredData = accumulatedData.filter(item => typeof item === 'object');

            if (filteredData && filteredData.length > 0) {

              if (mobile && filteredData.length > 0) {
                var mobileNumbers = mobile.split(',');
                filteredData = filteredData.filter(item =>
                  mobileNumbers.includes(item.mobileNumber)
                );


              }
              if (startDate && endDate && filteredData.length > 0) {
                filteredData = filteredData.filter(item => {
                  const blockDate = new Date(item.paidDate);
                  return blockDate >= new Date(startDate) && blockDate <= new Date(endDate);

                });
              }

              // Filter by employee names
              if (employeeNames && filteredData.length > 0) {
                filteredData = filteredData.filter(item =>
                  employeeNames.includes(item.blockEmpName)
                );
              }

              // Filter by customer names
              if (customerNames && filteredData.length > 0) {

                filteredData = filteredData.filter(item =>
                  customerNames.includes(item.customerName)
                );
              }


              // Filter by buying duration

              console.log("Filtered data after filtering:", filteredData);
              var updatedData = [];

              var uniqueVisitDetailIds = new Set();
              filteredData = filteredData.filter(item => {
                // Check if the current visitDetailId has already been encountered
                if (uniqueVisitDetailIds.has(item.blocksId)) {
                  // If the visitDetailId is already in the set, return false to exclude it from the filtered data
                  return false;
                } else {
                  // If the visitDetailId is not in the set, add it to the set and return true to include it in the filtered data
                  uniqueVisitDetailIds.add(item.blocksId);
                  updatedData.push(item);
                  return true;

                }
              });

              var checkingObject = updatedData.filter(item => item !== undefined && item !== null);
              var filteredData = accumulatedData.filter(item => typeof item === 'object' && item !== undefined && item !== null);


              // Check if there are any filtered results
              if (checkingObject.length === 0) {
                // If no results, clear the table body
                var tableBody = $('#dataTable tbody');
                tableBody.empty();
                return;
              }
              else {
                updateTable(updatedData);
                console.log(data, "datas");

              }

              // Update the table with the filtered data
            }
          }
          function updateTable(updatedData) {

            // Clear existing table rows
            var tableBody = $('#dataTable tbody');
            tableBody.empty();
            // Populate table with fetched data
            const companyId=localStorage.get('companyId');

            // Iterate through projectNames and create a new row for each project name
            updatedData.forEach(details => {
              if(companyId==details.companyId)
              {
                $('#dataTable tbody').append(`
                            <tr>          
                                <td>${new Date(details.paidDate).toLocaleDateString()}</td>
                                <td>${details.customerName}</td>
                                <td>${details.mobileNumber}</td>        
                                <td>${details.projectName}</td>
                                <td>${details.plotNumber}</td>
                                <td>${details.netAmount}</td>
                                <td>${details.totalPaidAmount}</td>
                                <td>${details.balance}</td>         
                           
                            <td>  
                              
                                <button type="button" class="btn btn-info btn-sm change-btn" data-company-id="${details.bookingId}" data-phone-number="${details.mobileNumber}" data-project-name="${details.projectName}"  data-booking-id="${details.bookingId}">Change</button>
                                    <button type="button" class="btn btn-info btn-sm cancel-btn" data-company-id="${details.bookingId}" data-phone-number="${details.mobileNumber}" data-project-name="${details.projectName}">Cancel</button>
                                    <button type="button" class="btn btn-info btn-sm edit-btn" data-booking-id="${details.bookingId}" >Add Payment</button>                         
                                      </td> 
                        </tr>
                    `);
                      }
            });


            $('#companyModal').modal('hide');
          }
        }


        $('#search-button').on('click', function () {
          var mobile = $('#mobile').val(); // Get the mobile number
          var fromDate = $('#fromDate').val();
          var toDate = $('#toDate').val();
          var employeeNames = $('#filterEmployeeNames').val();
          var customerNames = $('#filtercustomerNames').val();
          // var filterProjectName = $('#filterProjectName').val();

          // Validate the input if needed

          fetchVisitDetails(mobile, fromDate, toDate, employeeNames, customerNames);
        });



        function populateVisitDetails() {
          
            const MainMenus = localStorage.getItem('MainMenus');
                    const urlParams = new URLSearchParams(window.location.search);
            const companyId = localStorage.getItem('companyId'); // Parse companyId to integer
            const teamIdFromLocalStorage = localStorage.getItem('teamId');
            const canRelease = MainMenus && MainMenus.includes('BlockedList Release');
          
    // Parse teamIdFromLocalStorage into an array if it's not null
           const teamIds = teamIdFromLocalStorage ? teamIdFromLocalStorage.split(',').map(id => parseInt(id)) : [];
         
                    const accessToken = localStorage.getItem('accessToken');
                
      if (MainMenus && MainMenus.includes('Employee Form')) { 

                    
          $.ajax({
            url: 'http://localhost:8080/api/booking/getBookingByCompanyIdAndNonZeroBalance/'+companyId,
            type: 'GET',
            dataType: 'json',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': accessToken,
            },
            success: function (visitData) {
              // Populate table with fetched data
              console.log("book datas: ", visitData);
              const companyId=localStorage.getItem('companyId');
              visitData.forEach(details => {
                 
                  $('#dataTable tbody').append(`
                            <tr>       
                                <td>${new Date(details.paidDate).toLocaleDateString()}</td>
                                <td>${details.bookingId}</td>
                                <td>${details.mobileNumber}</td>        
                                <td>${details.projectName}</td>
                                <td>${details.plotNumber}</td>
                                <td>${details.netAmount}</td>
                                <td>${details.totalPaidAmount}</td>
                                <td>${details.balance}</td>       
                                <td>
                                    
                                    <button type="button" class="btn btn-info btn-sm change-btn" data-company-id="${details.bookingId}" data-phone-number="${details.mobileNumber}" data-project-name="${details.projectName}"  data-booking-id="${details.bookingId}">Change</button>
                                    <button type="button" class="btn btn-info btn-sm cancel-btn" data-company-id="${details.bookingId}" data-phone-number="${details.mobileNumber}" data-project-name="${details.projectName}">Cancel</button>
                                    <button type="button" class="btn btn-info btn-sm edit-btn" data-booking-id="${details.bookingId}">Edit</button>
                                       </td>
                            </tr>
                        `);
                
              });


              $('#companyModal').modal('hide');
            },
            error: function (xhr, status, error) {
              console.error(xhr.responseText); // Log the error response
              console.error(error); // Log the error message
              // showalert('Error fetching data from the server. Please try again later.'); // Display an error message to the user
            }
          });
        }
else
$.ajax({
            url: `http://localhost:8080/api/booking/getBookingByCompanyIdAndTeamIdAndNonZeroBalance/${companyId}/${teamIdFromLocalStorage}`,
            type: 'GET',
            dataType: 'json',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': accessToken,
            },
            success: function (visitData) {
              // Populate table with fetched data
              console.log("book datas: ", visitData);
              const companyId=localStorage.getItem('companyId');
                visitData.forEach(details =>
               {
                 $('#dataTable tbody').append(`
                            <tr>       
                                <td>${new Date(details.paidDate).toLocaleDateString()}</td>
                                <td>${details.bookingId}</td>
                                <td>${details.mobileNumber}</td>        
                                <td>${details.projectName}</td>
                                <td>${details.plotNumber}</td>
                                <td>${details.netAmount}</td>
                                <td>${details.totalPaidAmount}</td>
                                <td>${details.balance}</td>       
                                <td>  
                                    <button type="button" class="btn btn-info btn-sm change-btn" data-company-id="${details.bookingId}" data-phone-number="${details.mobileNumber}" data-project-name="${details.projectName}"  data-booking-id="${details.bookingId}">Change</button>
                                    <button type="button" class="btn btn-info btn-sm cancel-btn" data-company-id="${details.bookingId}" data-phone-number="${details.mobileNumber}" data-project-name="${details.projectName}">Cancel</button>
                                    <button type="button" class="btn btn-info btn-sm edit-btn" data-booking-id="${details.bookingId}">Edit</button>
                                    
                                </td>
                            </tr>
                        `);
              });

              $('#companyModal').modal('hide');
            },
            error: function (xhr, status, error) {
              console.error(xhr.responseText); // Log the error response
              console.error(error); // Log the error message
              // showalert('Error fetching data from the server. Please try again later.'); // Display an error message to the user
            }
          });
        }






        // Call the function to populate visit details when the page loads
        $(document).ready(function () {
          populateVisitDetails();
        });


        var currentCompanyId;
        /*         
            $('#saveEditBtn').click(function() {
                var bookingId = $('#bookingIdInput').val();
                var paidAmount = $('#paidAmountInput').val();
                const accessToken = localStorage.getItem('accessToken');
                $.ajax({
                    url: `http://localhost:8080/api/booking/updateBookPayment/${bookingId}/${paidAmount}/${}`,
                    type: 'PUT',
                    headers: {
                       
                        'Authorization': accessToken
                        },
                        success: function(response) 
                        {
                        $('#editModal').modal('hide');
                        // Update the UI with the new paid amount
                        $(`button.edit-btn[data-company-id='${bookingId}']`).closest('tr').find('td:eq(6)').text(paidAmount);
                        location.reload();
                        },
                    error: function(error) {
                        showalert('Failed to update the paid amount.');
                    }
                });
            });
        */
        let createdOn;

        let customerId;
        let siteVisitEmpId;
        let currentBookingId;
        let currentNetAmount;
        let balanceAmount;

        function editFunction(bookingId) 
        {
          var visitId = $(this).data('company-id');
          const accessToken = localStorage.getItem('accessToken');
          $.ajax({
            url: 'http://localhost:8080/api/booking/getBookingDetailsById/' + bookingId,
            type: 'GET',
            dataType: 'json',
            headers:
            {
              'Content-Type': 'application/json',
              'Authorization': accessToken,
            },
            success: function (data) 
            {
              console.log("customerName:", data.customerName);
              document.getElementById('customerNameInEditForm').value = data.customerName;
              document.getElementById('mobileNumberInEditForm').value = data.mobileNumber;
              document.getElementById('projectInEditForm').value = data.projectName;
              document.getElementById('plotNumberInEditForm').value = data.plotNumber;
              document.getElementById('paidByInEditForm').value = data.customerName;

              document.getElementById('receivedByInEditForm').value = localStorage.getItem('employeeName');

              createdOn = data.createdOn;
              customerId = data.customerId;
              siteVisitEmpId = data.siteVisitEmpId;
              currentBookingId = bookingId;
              currentNetAmount = data.netAmount;
              balanceAmount=data.balance;
              console.log("createdOn:", data.createdOn);
            },
            error: function (xhr, status, error) {
              console.error(xhr.responseText);
              console.error(error);
              //   showalert('Error fetching company details. Please try again later.');
            }
          });
        }
        $('#saveEditBtn').click(async function () {

          const paidAmountInput = document.getElementById('paidAmountInEditForm');
    if (!paidAmountInput) {
        console.error("Paid amount input element not found.");
        return;
    }
    const paidAmountValue = paidAmountInput.value;

    accessToken = localStorage.getItem('accessToken');
                $.ajax({
                    url: `http://localhost:8080/api/booking/updateBookPayment/${currentBookingId}/${paidAmountValue}/${balanceAmount}`,
                    type: 'PUT',
                    headers: {
                       
                        'Authorization': accessToken
                        },
                        success: function(response) 
                        {
                        $('#editModal').modal('hide');
                        // Update the UI with the new paid amount
                        location.reload();
                        },
                    error: function(error) {
                        showalert('Failed to update the paid amount.');
                    }
                });

          console.log("working");
          event.preventDefault();



          const createdOnForForm = createdOn;
          const customerIdForForm = customerId;
          const siteVisitIdForForm = siteVisitEmpId;
          const currentBookingIdForForm = currentBookingId;
          const currentNetAmountForForm = currentNetAmount;
          // const startingTimeInput = document.getElementById('startingTime');
          //console.log(startingTimeInput,'hi');
          //const startingTimeValue = new Date(startingTimeInput.value).toISOString().slice(0, 19).replace('T', ' ');

          const bookPay = {

            createdOn: createdOnForForm,
            customerId: customerIdForForm,
            siteVisitEmpId: siteVisitIdForForm,
            bookingId: currentBookingIdForForm,
            customerName: document.getElementById('customerNameInEditForm').value,
            mobileNumber: document.getElementById('mobileNumberInEditForm').value,
            projectName: document.getElementById('projectInEditForm').value,

            plotNumber: document.getElementById('plotNumberInEditForm').value,
            deno500: document.getElementById('row1col3').value,
            denoa500: document.getElementById('row1col4').value,
            deno200: document.getElementById('row2col3').value,
            denoa200: document.getElementById('row2col4').value,
            deno100: document.getElementById('row3col3').value,
            denoa100: document.getElementById('row3col4').value,
            deno50: document.getElementById('row4col3').value,
            denoa50: document.getElementById('row4col4').value,
            deno20: document.getElementById('row5col3').value,
            denoa20: document.getElementById('row5col4').value,
            deno10: document.getElementById('row6col3').value,
            denoa10: document.getElementById('row6col4').value,
            denoTotalNotes: document.getElementById('denoTotalNotes').value,
            denoTotalAmount: document.getElementById('denoTotalAmount').value,

            cdtNo: document.getElementById('cdtNo').value,
            cdtDate: document.getElementById('cdtDate').value,
            netAmount: currentNetAmountForForm,

            paidAmount: document.getElementById('paidAmountInEditForm').value,
            paidDate: document.getElementById('paidDateInEditForm').value,
            paymentType: document.getElementById('paymentTypeInEditForm').value,
            paymentMode: document.getElementById('paymentModeInEditForm').value,
            paidBy: document.getElementById('paidByInEditForm').value,
            receivedBy: document.getElementById('receivedByInEditForm').value,
            bankName: document.getElementById('bankName').value

          };

          console.log("bookpay:", bookPay);
          //formData.append('blocks', new Blob([JSON.stringify(blocks)], { type: 'application/json' }));
          // ... (remaining file upload logic)
           accessToken = localStorage.getItem('accessToken');
          try {
            const response = await fetch('http://localhost:8080/api/booking/addBookPay', {
              method: 'POST',
              headers: {
                // Specify the content type as JSON
                'Authorization': accessToken,
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(bookPay), // Convert the JavaScript object to JSON stri
              credentials: 'include'
            });
            showalert('Booking Details updated successfully', function()
            {
            window.location.href = 'booking_list.html';
      });
            // Optionally, redirect or perform any other action upon successful submission
          } catch (error) {
            console.error('Error:', error);
            showalert('Failed to add Book Details', function(){
              window.location.href = 'booking_list.html';
            });
          }
        });
      });
    </script>
    <script>
      // Define the function outside of $(document).ready() scope
      function toggleDenominationTable() {
        // Prevent the default form submission behavior
        event.preventDefault();

        // Toggle the visibility of the denomination table
        var tableContainer = document.getElementById("denominationTableContainer");
        if (tableContainer.style.display === "none") {
          tableContainer.style.display = "block";
        } else {
          tableContainer.style.display = "none";
        }
      }
      function toggleCardTransactionTable() {
        // Prevent the default form submission behavior
        event.preventDefault();

        // Toggle the visibility of the denomination table
        var tableContainer = document.getElementById("BankTableContainer");
        if (tableContainer.style.display === "none") {
          tableContainer.style.display = "block";
        } else {
          tableContainer.style.display = "none";
        }
      }
      $('input[name^="row"][name$="col3"]').change(function () {
        var totalNotes = 0;
        $('input[name^="row"][name$="col3"]').each(function () {
          var value = parseFloat($(this).val());
          if (!isNaN(value)) {
            console.log(totalNotes, "shanmathi");
            totalNotes += value;
          }
        });
        $('#denoTotalNotes').val(totalNotes);
      });
      $('input[name^="row"][name$="col3"]').change(function () {
        var totalNotes = 0;
        var totalAmounts = 0;

        // Iterate over all col3 inputs to calculate totalNotes and update corresponding col4 values
        $('input[name^="row"][name$="col3"]').each(function () {
          var value = parseFloat($(this).val());
          if (!isNaN(value)) {
            var currentRow = $(this).closest('tr');
            var rupees = parseFloat(currentRow.find('td:nth-child(2)').text());

            // Calculate total amount for the corresponding col4 input
            if (!isNaN(rupees)) {
              var totalAmount = rupees * value;
              currentRow.find('input[name$="col4"]').val(totalAmount);
              totalAmounts += totalAmount;
            }

            // Update totalNotes
            totalNotes += value;
          }
        });

        // Set the calculated totalNotes and totalAmounts to their respective input fields
        $('#denoTotalNotes').val(totalNotes);
        $('#denoTotalAmount').val(totalAmounts);
      });

  







    </script>
    <!-- plugins:js -->
  <script src="../../assets/vendors/js/vendor.bundle.base.js"></script></script>
 */
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="../../assets/vendors/chart.js/Chart.min.js"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="../../assets/js/off-canvas.js"></script>
    <script src="../../assets/js/hoverable-collapse.js"></script>
    <!-- <script src="../../assets/js/pagination.js"></script> -->
    <script src="../../assets/js/menu_active.js"></script>
    <script src="../../assets/js/misc.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="../../assets/js/chart.js"></script>
    <!-- End custom js for this page -->
</body>

</html>