
<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Block Page Form | Aishalaya</title>
  <link rel="shortcut icon" href="../../assets/images/aishLogo.ico"/>
  <!-- plugins:css -->
  <link rel="stylesheet" href="../../assets/vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="../../assets/vendors/css/vendor.bundle.base.css">
  <!-- endinject -->
  <!-- Plugin css for this page -->
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <!-- endinject -->
  <!-- Layout styles -->
  <link rel="stylesheet" href="http://127.0.0.1:5500/assets/css/style.css">
 
  <!-- Include Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Custom CSS for tabs */
    .nav-tabs .nav-link {
      color: #000; /* Change the color of the tab text */
    }
    .nav-tabs .nav-link.active {
      color: #007bff; /* Change the color of the active tab text */
    }
  </style>
<!--showalert Message-->
<script src="assets/js/alertMessages.js"></script>
   
</head>

<body>
  <div class="container-scroller">
    <!-- partial:../../partials/_navbar.html -->
    <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
        <a class="navbar-brand brand-logo" href="../../index.html"><img src="../../assets/images/logo.png" alt="logo" style="height: 100%;"/></a>
        <a class="navbar-brand brand-logo-mini" href="../../index.html"><img src="../../assets/images/logo.png" alt="logo" style="height: 100%;"/></a>
      </div>
      <div class="navbar-menu-wrapper d-flex align-items-stretch">
        <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
          <span class="mdi mdi-menu"></span>
        </button>
        <ul class="navbar-nav navbar-nav-right">
          <li class="nav-item d-none d-lg-block full-screen-link">
            <a class="nav-link">
              <i class="mdi mdi-fullscreen" id="fullscreen-button"></i>
            </a>
          </li>
          <li class="nav-item nav-logout d-none d-lg-block">
            <a class="nav-link" href="#">
              <i class="mdi mdi-power"></i>
            </a>
          </li>

        </ul>
        <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
          <span class="mdi mdi-menu"></span>
        </button>
      </div>
    </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <div id="includeHtml"></div>

      <div class="main-panel">
        <div class="content-wrapper">
          <div class="page-header">
            <h3 class="page-title"> Block Page Form </h3>
            <nav aria-label="breadcrumb">            
            </nav>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <form class="form-sample" id="employeeForm">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="gender1">Select Customer</label>
                              <div class="col-sm-9">
                                <div class="input-group" id="selectContainer">
                                  <select id="gender1" name="gender1" class="form-control">
                                   
                                  </select>
                                  <div class="input-group-append">
                                    <span class="input-group-text"><i class="fa fa-caret-down"></i></span>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                           
                         
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item" role="presentation">
                          <a class="nav-link active" id="icon-tab-0" data-bs-toggle="tab" href="#icon-tabpanel-0" role="tab" aria-controls="icon-tabpanel-0" aria-selected="true"> Site Vist</a>
                        </li>
                        <li class="nav-item" role="presentation">
                          <a class="nav-link" id="icon-tab-1" data-bs-toggle="tab" href="#icon-tabpanel-1" role="tab" aria-controls="icon-tabpanel-1" aria-selected="false"> Bill Information</a>
                        </li>
                        <li class="nav-item" role="presentation">
                          <a class="nav-link" id="icon-tab-2" data-bs-toggle="tab" href="#icon-tabpanel-2" role="tab" aria-controls="icon-tabpanel-2" aria-selected="false">Plot</a>
                        </li>
                          
                      </ul>
                      <div class="tab-content pt-5" id="tab-content">
                        <div class="tab-pane active" id="icon-tabpanel-0" role="tabpanel" aria-labelledby="icon-tab-0"> <table id="siteVisitTable" class="table table-hover">
                            <tbody>
                                <tr>
                                    <td>Customer Code:</td>
                                    <td id="customerCode"></td>
                                </tr>
                                <tr>
                                    <td>Mobile Number:</td>
                                    <td id="mobileNumber"></td>
                                </tr>
                                <tr>
                                    <td>Preferred Location:</td>
                                    <td id="location"></td>
                                </tr>
                                <!-- <tr>
                                    <td>Preferred Budget:</td>
                                    <td id="preferredBudget"></td>
                                </tr> -->
                                <tr>
                                    <td>Email:</td>
                                    <td id="email"></td>
                                </tr>
                                
                                <tr>
                                    <td>Employee Type:</td>
                                    <td id="employeeType"></td>
                                </tr>
                                <tr>
                                    <td>Work Place:</td>
                                    <td id="workPlace"></td>
                                </tr>
                                <tr>
                                    <td>Address:</td>
                                    <td id="address"></td>
                                </tr>
                            </tbody>
                        </table></div>
                        <div class="tab-pane" id="icon-tabpanel-1" role="tabpanel" aria-labelledby="icon-tab-1">
                            <div class="row">
                  
                                <div class="col-md-12">
                                  <div class="form-group row">
                                    <label class="col-sm-9 col-form-label" for="customerName">Customer Name</label>
                                    <div class="col-sm-9">
                                      <input class="form-control" type="text" id="customerName" name="customerName" />
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="form-group row">
                                    <label class="col-sm-9 col-form-label" for="mobileNumber1">Mobile Number</label>
                                    <div class="col-sm-9">
                                      <input class="form-control" type="text" id="mobileNumber1" name="mobileNumber1" />
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="form-group row">
                                    <label class="col-sm-3 col-form-label" for="email1">Email</label>
                                    <div class="col-sm-9">
                                      <input class="form-control" type="text" id="email1" name="email1" />
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="form-group row">
                                    <label class="col-sm-9 col-form-label" for="houseName">Door No. / House Name</label>
                                    <div class="col-sm-9">
                                      <input class="form-control" type="text" id="houseName" name="houseName" />
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="form-group row">
                                    <label class="col-sm-9 col-form-label" for="streetName">Street Name</label>
                                    <div class="col-sm-9">
                                      <input class="form-control" type="text" id="streetName" name="streetName" />
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-12">
                                  <div class="form-group row">
                                    <label class="col-sm-3 col-form-label" for="area">Area</label>
                                    <div class="col-sm-9">
                                      <input class="form-control" type="text" id="area" name="area" />
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="form-group row">
                                    <label class="col-sm-3 col-form-label" for="city">City</label>
                                    <div class="col-sm-9">
                                      <input class="form-control" type="text" id="city" name="city" />
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="form-group row">
                                    <label class="col-sm-3 col-form-label" for="district">District</label>
                                    <div class="col-sm-9">
                                      <input class="form-control" type="text" id="district" name="district" />
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="form-group row">
                                    <label class="col-sm-3 col-form-label" for="state">State</label>
                                    <div class="col-sm-9">
                                      <input class="form-control" type="text" id="state" name="state"  />
                                    </div>
                                  </div>
                                </div>
                                <div class="col-md-6">
                                  <div class="form-group row">
                                    <label class="col-sm-3 col-form-label" for="postalCode">Postal Code</label>
                                    <div class="col-sm-9">
                                      <input class="form-control" type="text" id="postalCode" name="postalCode"  />
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="tab-pane" id="icon-tabpanel-2" role="tabpanel" aria-labelledby="icon-tab-2">
                              <h4 class="card-title" style="margin-top: 2em;">Block Plot Information</h4>
                              <div class="container mt-5">
                                  <div class="table-responsive">
                                      <table class="table table-bordered" id="dataTable">
                                          <thead>
                                              <tr>
                                                  <th>Project</th>
                                                  <th>Plot No </th>
                                                  <th>Total SQFT</th>
                                                  <th>Rate Per SQFT</th>
                                                  <th>Total Values</th>
                                                  <th>Description</th>
                                                  <th>Status</th>
                                              </tr>
                                          </thead>
                                          <tbody>
                                              <tr>
                                                  <td>
                                                      <select class="form-control" id="projectName" name="projectName">
                                                          <option value="" disabled selected>Select a Project</option>
                                                          <!-- Options to be populated dynamically -->
                                                      </select>
                                                  </td>
                                                  <td>
                                                      <select class="form-control" id="plotNumber" name="plotNumber">
                                                          <option value="" disabled selected>Select a Plot</option>
                                                          <!-- Options will be populated dynamically -->
                                                      </select>
                                                  </td>
                                                  <td><input type="text" class="form-control" id="totalsqrt" name="totalsqrt" readonly></td>
                                                  <td><input type="text" class="form-control" id="ratePerSqft" name="ratePerSqft" readonly></td>
                                                  <td><input type="text" class="form-control" id="totalValues" name="totalValues" readonly></td>
                                                  <td><input type="text" class="form-control" id="description" name="description" readonly></td>
                                                  <td><input type="text" class="form-control" id="status" name="status" readonly></td>
                                              </tr>
                                          </tbody>
                                      </table>
                                  </div>
                              </div>
                              <div class="d-flex justify-content-end">
                                  <button type="button" class="btn back custom-width" onclick="window.location.href='employee_list.html';">Back</button>
                                  <button type="submit" class="btn btn-gradient-primary me-2" value="submit">Submit</button>
                                  <button class="btn btn-light">Cancel</button>
                              </div>
                          </div>
                          
                          
                          
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- content-wrapper ends -->
      <!-- partial:../../partials/_footer.html -->
      <div id="includeFooder"></div>
      <!-- partial -->
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->
     <!-- Bootstrap Bundle with Popper.js -->
     <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <!-- plugins:js -->
  <script src="../../assets/vendors/js/vendor.bundle.base.js"></script></script>
 */
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="../../assets/vendors/chart.js/Chart.min.js"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="../../assets/js/off-canvas.js"></script>
    <script src="../../assets/js/hoverable-collapse.js"></script>
    <!-- <script src="../../assets/js/pagination.js"></script> -->  
    <script src="../../assets/js/menu_active.js"></script>
    <script src="../../assets/js/misc.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="../../assets/js/chart.js"></script>
  <!-- endinject -->
  <!-- Custom js for this page -->
  <script src="../../assets/js/file-upload.js"></script>
  <!-- End custom js for this page -->
   <script>
    
$(document).ready(function() {
  const accessToken = localStorage.getItem('accessToken');
            // Fetch customer details and populate dropdown
            $.getJSON({
              url:'http://localhost:8080/api/customer/getAllCustomerDetails',
              headers: {
              'Content-Type': 'application/json',
              'Authorization': accessToken,
            },
            function(data) {
    $.each(data, function(index, item) {
        // Construct the option text with customer name, mobile number, and employee code
        const optionText = `${item.customerName} - ${item.mobileNumber} - ${item.employeeCode}`;
        // Append option element with value and text
        $('#gender1').append($('<option>', {
            value: optionText,
            text: optionText
        }));
                });
            }});
            // Event listener for customer selection change
            $('#gender1').change(function() {
                const selectedValue = $(this).val();
                const [customerName, mobileNumber, employeeCode] = selectedValue.split(' - ');
                const accessToken = localStorage.getItem('accessToken');
                $.ajax({
                    url: `http://localhost:8080/api/customer/getCustomer/${customerName}/${mobileNumber}/${employeeCode}`,
                    type: 'GET',
                    dataType: 'json',
                    headers: {
                    'Content-Type': 'application/json',
                    'Authorization': accessToken,
                    },
                    success: function(customer) {
                        $('#customerCode').text(customer.customerCode);
                        $('#mobileNumber').text(customer.mobileNumber);
                        $('#location').text(customer.location);
                        $('#email').text(customer.email);
                        $('#employeeType').text(customer.employeeType);
                        $('#workPlace').text(customer.workPlace);
                        $('#address').text(customer.address);
                        $('#customerName').val(customer.customerName);
                       $('#mobileNumber1').val(customer.mobileNumber);
                       $('#email1').val(customer.email);
                       $('#houseName').val(customer.address);
                       $('#streetName').val(customer.streetName);
                       $('#area').val(customer.area);
                       $('#city').val(customer.city);
                       $('#district').val(customer.district);
                       $('#state').val(customer.state);
                       $('#postalCode').val(customer.postalCode);
                    },
                    error: function(xhr, status, error) {
                        console.error(xhr.responseText);
                        console.error(error);
                        showalert('Error fetching customer details. Please try again later.');
                    }
                });
            });
        });

        $(document).ready(function() {
    // Event listener for when the select customer dropdown changes
    $('#gender1').change(function() {
        // Get the selected value from the dropdown
        const selectedValue = $(this).val();

        // Extract customer name, mobile number, and employee code from the selected value
        const [customerName, mobileNumber, employeeCode] = selectedValue.split(' - ');

        // Make an AJAX request to fetch customer details
        const accessToken = localStorage.getItem('accessToken');
        $.ajax({
            url: `http://localhost:8080/api/customer/getCustomer/${customerName}/${mobileNumber}/${employeeCode}`,
            type: 'GET',
            dataType: 'json',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': accessToken,
            },
            success: function(customer) {
                // Populate the table with the fetched customer details
                $('#siteVisitTable #customererCode').text(customer.customerCode);
                $('#siteVisitTable #mobileNumber').text(customer.mobileNumber);
                $('#siteVisitTable #preferredLocation').text(customer.location);
                $('#siteVisitTable #email').text(customer.email);
                $('#siteVisitTable #employeeType').text(customer.employeeType);
                $('#siteVisitTable #workPlace').text(customer.workPlace);
                $('#siteVisitTable #address').text(customer.address);
            },
            error: function(xhr, status, error) {
                console.error(xhr.responseText); // Log the error response
                console.error(error); // Log the error message
                showalert('Error fetching customer details. Please try again later.'); // Display an error message to the user
            }
        });
    });
});


$(document).ready(function() {
    // Event listener for form submission
    $('#employeeForm').submit(function(event) {
        // Prevent default form submission
        event.preventDefault();

        // Get values from form fields
         // Fetch customerCode from the HTML structure
        const customerName = $('#customerName').val();
        const mobileNumber = $('#mobileNumber').val();
        const email = $('#email1').val();
        const houseName = $('#houseName').val();
        const streetName = $('#streetName').val();
        const area = $('#area').val();
        const city = $('#city').val();
        const district = $('#district').val();
        const state = $('#state').val();
        const postalCode = $('#postalCode').val();
        const projectName = $('#projectName').val();
        const plotNumber = $('#plotNumber').val();
        const totalsqrt = $('#totalsqrt').val();
        const ratePerSqft = $('#ratePerSqft').val();
        const totalValues = $('#totalValues').val();
        const description = $('#description').val();
        const status = $('#status').val();

        // Create an object with the values
        const formData = {
            
            customerName: customerName,
            mobileNumber: mobileNumber,
            email: email,
            houseName: houseName,
            streetName: streetName,
            area: area,
            city: city,
            district: district,
            state: state,
            postalCode: postalCode,
            projectName: projectName,
            plotNumber: plotNumber,
            totalsqrt: totalsqrt,
            ratePerSqft: ratePerSqft,
            totalValues: totalValues,
            description: description,
            status: status
        };

        // Send data to the server using AJAX
        

        const accessToken = localStorage.getItem('accessToken');
        $.ajax({
            url: 'http://localhost:8080/api/blocks/addBlocks',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(formData),
            headers: {
              'Content-Type': 'application/json',
              'Authorization': accessToken,
            },
            success: function(response) {
                // Handle success response
                console.log('Data successfully submitted:', response);
                showalert('Data successfully submitted.');
                // Clear form fields
                $('#employeeForm')[0].reset();
            },
            error: function(xhr, status, error) {
                // Handle error response
                console.error('Error submitting data:', error);
                showalert('Error submitting data. Please try again later.');
            }
        });
    });
});

$(document).ready(function () {
    // Fetch all plot numbers and populate the dropdown
    const accessToken = localStorage.getItem('accessToken');
    $.ajax({
        url: 'http://localhost:8080/api/project/projectLayoutDetails',
        method: 'GET',
        headers: {
              'Content-Type': 'application/json',
              'Authorization': accessToken,
            },
        success: function (response) {
            if (Array.isArray(response)) {
                var plotNumbers = response.map(function(obj) {
                    return obj.plotNumber;
                });
                var plotNumberDropdown = $('#plotNumber');
                plotNumberDropdown.empty(); // Clear existing options
                plotNumberDropdown.append('<option value="" disabled selected>Select a Plot</option>'); // Add default option
                plotNumbers.forEach(function (plotNumber) {
                    plotNumberDropdown.append('<option value="' + plotNumber + '">' + plotNumber + '</option>');
                });
            } else {
                console.error('Invalid response data:', response);
            }
        },
        error: function (xhr, status, error) {
            console.error('Error fetching plot numbers:', error);
        }
    });

    
    // Event listener for plotNumber change
    $('#plotNumber').change(function () {
        var selectedPlot = $(this).val();
        if (selectedPlot) {
            // Fetch details for the selected plot number
            const accessToken = localStorage.getItem('accessToken');
            $.ajax({
                url: `http://localhost:8080/api/project/getProjectLayoutByPlotNo/${selectedPlot}`,
                method: 'GET',
                headers: {
              'Content-Type': 'application/json',
              'Authorization': accessToken,
            },
                success: function (response) {
                    // Populate form fields with the response data
                    $('#totalsqrt').val(response.totalSqft);
                    $('#ratePerSqft').val(response.rate);
                    $('#totalValues').val(response.totalValue);
                    $('#description').val(response.descrip);
                    $('#status').val(response.status);
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching plot details:', error);
                }
            });
        } else {
            // Clear form fields if no plot number is selected
            $('#totalsqrt').val('');
            $('#ratePerSqft').val('');
            $('#totalValues').val('');
            $('#description').val('');
            $('#status').val('');
        }
    });
});

$(document).ready(function () {
    // Clear fields when the form reloads
    $('#totalsqrt').val('');
    $('#ratePerSqft').val('');
    $('#totalValues').val('');
    $('#description').val('');
    $('#status').val('');
});


$(document).ready(function () {
    $('#customerName').val('');
    $('#mobileNumber1').val('');
    $('#email1').val('');
    $('#houseName').val('');
    $('#streetName').val('');
    $('#area').val('');
    $('#city').val('');
    $('#district').val('');
    $('#state').val('');
    $('#postalCode').val('');
});

$(document).ready(function () {
  const accessToken = localStorage.getItem('accessToken');
    // Fetch project details and populate the dropdown
    $.ajax({
        url: 'http://localhost:8080/api/project/getAllProjectDetails',
        method: 'GET',
        headers: {
              'Content-Type': 'application/json',
              'Authorization': accessToken,
            },
        success: function (response) {
            var projectNames = response; // Assuming response is an array of project objects
            var projectNameDropdown = $('#projectName');
            projectNameDropdown.empty(); // Clear existing options
            projectNameDropdown.append('<option value="" disabled selected>Select a projectName</option>'); // Add default option
            projectNames.forEach(function (project) {
                projectNameDropdown.append('<option value="' + project.projectId + '">' + project.projectName + '</option>');
            });
        },
        error: function (xhr, status, error) {
            console.error('Error fetching project details:', error);
        }
    });

    // Other code for handling plotNumber selection and other functionalities
});



            </script>
                    

</body>

</html>