<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Block Form | Aishalaya</title>
  <link rel="shortcut icon" href="../../assets/images/aishLogo.ico" />
  <!-- plugins:css -->
  <link rel="stylesheet" href="../../assets/vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="../../assets/vendors/css/vendor.bundle.base.css">
  <!-- endinject -->
  <!-- Plugin css for this page -->
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <!-- endinject -->
  <!-- Layout styles -->
  <link rel="stylesheet" href="http://127.0.0.1:5500/assets/css/style.css">
 
  <!-- Include Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <!-- Bootstrap CSS -->
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
  <!--showalert Message-->
  <script src="http://127.0.0.1:5500/assets/js/alertMessages.js"></script>
 
   
  <style>
    /* Custom CSS for tabs */
    .nav-tabs .nav-link {
      color: #000;
      /* Change the color of the tab text */
    }

    .nav-tabs .nav-link.active {
      color: #007bff;
      /* Change the color of the active tab text */
    }
  </style>

</head>

<body>
  <div class="container-scroller">
    <!-- partial:../../partials/_navbar.html -->
    <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
        <a class="navbar-brand brand-logo" href="/pages/dashboard/dashboard.html"><img
            src="../../assets/images/logo.png" alt="logo" style="height: 100%;" /></a>
        <a class="navbar-brand brand-logo-mini" href="/pages/dashboard/dashboard.html"><img
            src="../../assets/images/logo.png" alt="logo" style="height: 100%;" /></a>
      </div>
      <div class="navbar-menu-wrapper d-flex align-items-stretch">
        <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
          <span class="mdi mdi-menu"></span>
        </button>
        <ul class="navbar-nav navbar-nav-right">
          <li class="nav-item d-none d-lg-block full-screen-link">
            <a class="nav-link">
              <i class="mdi mdi-fullscreen" id="fullscreen-button"></i>
            </a>
          </li>
          <li class="nav-item nav-logout d-none d-lg-block">
            <a class="nav-link" href="#">
              <i class="mdi mdi-power"></i>
            </a>
          </li>

        </ul>
        <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button"
          data-toggle="offcanvas">
          <span class="mdi mdi-menu"></span>
        </button>
      </div>
    </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <div id="includeHtml"></div>

      <div class="main-panel">
        <div class="content-wrapper">
          <div class="page-header">
            <h3 class="page-title"> Block Form </h3>

          </div>
          <div class="row">

            <div class="col-12">
              <div class="card">
                <div class="card-body">

                  <form class="form-sample" id="BlockForm">

                    <div class="row">

                      <div class="col-md-6">
                        <div class="form-group row">
                          <label class="col-sm-9 col-form-label" for="customername">Customer Name</label>
                          <div class="col-sm-9">
                            <input class="form-control" placeholder="Customer Name" type="text" id="customername"
                              name="customername" readonly />
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group row">
                          <label class="col-sm-9 col-form-label" for="SiteVisitEmployeeName">Site Visit Employee
                            Name</label>
                          <div class="col-sm-9">
                            <input class="form-control" placeholder="SiteVisitEmployeeName" type="text"
                              id="SiteVisitEmployeeName" name=" " readonly />
                          </div>
                        </div>
                      </div>

                      <div class="col-md-6">
                        <div class="form-group row">
                          <label class="col-sm-9 col-form-label" for="BlockEmployeeName">Block Employee Name</label>
                          <div class="col-sm-9">
                            <input class="form-control" placeholder="BlockEmployeeName" type="text"
                              id="BlockEmployeeName" name="BlockEmployeeName" readonly />
                          </div>
                        </div>
                      </div>

                    </div>

                    <ul class="nav nav-tabs" role="tablist">
                      <li class="nav-item" role="presentation">
                        <a class="nav-link active" id="icon-tab-0" data-bs-toggle="tab" href="#icon-tabpanel-0"
                          role="tab" aria-controls="icon-tabpanel-0" aria-selected="true"> Site Vist</a>
                      </li>
                      <li class="nav-item" role="presentation">
                        <a class="nav-link" id="icon-tab-1" data-bs-toggle="tab" href="#icon-tabpanel-1" role="tab"
                          aria-controls="icon-tabpanel-1" aria-selected="false"> Bill Information</a>
                      </li>
                      <li class="nav-item" role="presentation">
                        <a class="nav-link" id="icon-tab-2" data-bs-toggle="tab" href="#icon-tabpanel-2" role="tab"
                          aria-controls="icon-tabpanel-2" aria-selected="false">Plot</a>
                      </li>
                      <li class="nav-item" role="presentation">
                        <a class="nav-link" id="icon-tab-3" data-bs-toggle="tab" href="#icon-tabpanel-3" role="tab"
                          aria-controls="icon-tabpanel-3" aria-selected="false">Payment</a>
                      </li>

                    </ul>
                    <div class="tab-content pt-5" id="tab-content">
                      <div class="tab-pane active" id="icon-tabpanel-0" role="tabpanel" aria-labelledby="icon-tab-0">
                        <table id="siteVisitTable" class="table table-hover">
                          <!-- append(` -->

                          <tbody>
                            <tr>
                              <td>Customer Code:</td>
                              <td id="customCode"></td>
                            </tr>
                            <tr>
                              <td>Mobile Number:</td>
                              <td id="mobileNumber"></td>
                            </tr>
                            <tr>
                              <td>Preferred Location:</td>
                              <td id="location"></td>
                            </tr>
                            <!-- <tr>
<td>Preferred Budget:</td>
<td id="preferredBudget"></td>
</tr> -->
                            <tr>
                              <td>Email:</td>
                              <td id="email"></td>
                            </tr>

                            <tr>
                              <td>Employee Type:</td>
                              <td id="employeeType"></td>
                            </tr>
                            <tr>
                              <td>Work Place:</td>
                              <td id="workPlace"></td>
                            </tr>
                            <tr>
                              <td>Address:</td>
                              <td id="address"></td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div class="tab-pane" id="icon-tabpanel-1" role="tabpanel" aria-labelledby="icon-tab-1">
                        <div class="row">

                          <div class="col-md-12">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="customerName">Customer Name</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="customerName" name="customerName" />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="mobileNumber1">Mobile Number</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="mobileNumber1" name="mobileNumber1" />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-group row">
                              <label class="col-sm-3 col-form-label" for="email1">Email</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="email1" name="email1" />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="houseName">Door No. / House Name</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="houseName" name="houseName" />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="streetName">Street Name</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="streetName" name="streetName" />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-12">
                            <div class="form-group row">
                              <label class="col-sm-3 col-form-label" for="area">Area</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="area" name="area" />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-group row">
                              <label class="col-sm-3 col-form-label" for="city">City</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="city" name="city" />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-group row">
                              <label class="col-sm-3 col-form-label" for="district">District</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="district" name="district" />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-group row">
                              <label class="col-sm-3 col-form-label" for="state">State</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="state" name="state" />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-group row">
                              <label class="col-sm-3 col-form-label" for="postalCode">Postal Code</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="postalCode" name="postalCode" />
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="tab-pane" id="icon-tabpanel-2" role="tabpanel" aria-labelledby="icon-tab-2">
                        <h4 class="card-title" style="margin-top: 2em;">Block Plot Information</h4>
                        <div class="container mt-5">
                          <div class="col-md-4">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="siteVisitProjectName">Project :</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="siteVisitProjectName"
                                  name="siteVisitProjectName" readonly placeholder="total sqft" />
                              </div>
                            </div>
                          </div>
                          <div class="table-responsive">
                            <table class="table table-bordered" id="dataTable">
                              <thead>
                                <tr>
                                  <th>Plot No <span class="text-danger">*</span></th>
                                  <th>Plot Status </th>
                                  <th>Total SQFT</th>
                                  <th>Rate Per SQFT</th>
                                  <th>Total Values</th>
                                  <th>Description</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td> <select id="plotNumber" name="plotNumber" class="form-control" required>
                                      <option value="" disabled selected>Select Plot Number <span
                                          class="text-danger">*</span></option>
                                    </select>
                                  </td>
                                  <td><input type="text" class="form-control" id="status" name="status" readonly
                                      placeholder="status"></td>

                                  <td><input type="text" class="form-control" id="totalsqrt" name="totalsqrt" readonly
                                      placeholder="Total sqrt"></td>
                                  <td><input type="text" class="form-control" id="rate" name="rate" readonly
                                      placeholder="rate"></td>
                                  <td><input type="text" class="form-control" id="totalValues" name="totalValues"
                                      readonly placeholder="total values" readonly></td>
                                  <td><input type="text" class="form-control" id="description" name="description"
                                      readonly placeholder="description"></td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                      <div class="tab-pane" id="icon-tabpanel-3" role="tabpanel" aria-labelledby="icon-tab-3">
                        <div class="row">

                          <div class="col-md-4">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="totaSqft">Total SQFT</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="totaSqft" name="totaSqft" readonly
                                  placeholder="total sqft" />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="sellingRate">Selling Rate <span
                                  class="text-danger">*</span></label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="sellingRate" name="sellingRate"
                                  placeholder="selling rate" required />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="totalAmount">Total Amount ₹</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="totalAmount" name="totalAmount" readonly
                                  placeholder="total amount" />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="discount">Discount % <span
                                  class="text-danger">*</span></label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="discount" name="discount"
                                  placeholder="discount" required />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="netAmount">Net Amount ₹ </label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="netAmount" name="netAmount" readonly
                                  placeholder="net amount" />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="paidAmount">Paid Amount ₹ <span
                                  class="text-danger">*</span></label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="paidAmount" name="paidAmount"
                                  placeholder="paid amount" oninput="validateInputNumeric(event)" required />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="PaidDate">Paid Date</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="date" id="PaidDate" name="PaidDate" />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="PaymentType">Payment Type</label>
                              <div class="col-sm-9">
                                <select class="form-control" id="PaymentType" name="PaymentType">
                                  <option value="" disabled selected>Select Payment Type</option>
                                  <option value="Full Payment">Full Payment</option>
                                  <option value="Advance">Advance</option>

                                </select>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-4">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="PaymentMode">Payment Mode</label>
                              <div class="col-sm-9">
                                <select class="form-control" id="PaymentMode" name="PaymentMode">
                                  <option value="" disabled selected>Select Payment Mode</option>
                                  <option value="Cash">Cash</option>
                                  <option value="Cheque">Cheque</option>
                                  <option value="DD">DD</option>
                                  <option value="NEFT">NEFT</option>
                                  <option value="RTGS">RTGS</option>
                                </select>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="PaidBy">Paid By</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="PaidBy" name="PaidBy" placeholder="paid by"
                                  oninput="validateInputString(event)" />
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-group row">
                              <label class="col-sm-9 col-form-label" for="ReceivedBy">Received By</label>
                              <div class="col-sm-9">
                                <input class="form-control" type="text" id="ReceivedBy" name="ReceivedBy"
                                  placeholder="received by" oninput="validateInputString(event)" />
                              </div>
                            </div>
                          </div>

                          <div class="btn-group">
                            <div class="col">
                              <button type="button" id="toggleTableBtnDenomination" class="btn btn-sm btn btn-primary"
                                onclick="toggleDenominationTable()">Cash Denomination Table</button>

                              <button type="button" id="toggleTableBtnCardTransaction"
                                class="btn btn-sm btn btn-primary" onclick="toggleCardTransactionTable()">card
                                Denomination Table</button>
                            </div>
                          </div>

                          <div id="denominationTableContainer" style="display: none;" class="row">
                            <h5>Denomination</h5>
                            <div class="table-responsive">
                              <table class="table table-striped">
                                <thead>
                                  <tr>
                                    <th>S.no</th>
                                    <th>Rupees</th>
                                    <th>No.of.Notes</th>
                                    <th>Total Amount</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr>
                                    <td>1</td>
                                    <td>500</td>
                                    <td><input class="form-control" type="text" name="row1col3" id="row1col3"></td>
                                    <td><input class="form-control" type="text" name="row1col4" id="row1col4" readonly>
                                    </td>
                                  </tr>
                                  <tr>
                                    <td>2</td>
                                    <td>200</td>
                                    <td><input class="form-control" type="text" name="row2col3" id="row2col3"></td>
                                    <td><input class="form-control" type="text" name="row2col4" id="row2col4"></td>
                                  </tr>
                                  <tr>
                                    <td>3</td>
                                    <td>100</td>
                                    <td><input class="form-control" type="text" name="row3col3" id="row3col3"></td>
                                    <td><input class="form-control" type="text" name="row3col4" id="row3col4"></td>
                                  </tr>
                                  <tr>
                                    <td>4</td>
                                    <td>50</td>
                                    <td><input class="form-control" type="text" name="row4col3" id="row4col3"></td>
                                    <td><input class="form-control" type="text" name="row4col4" id="row4col4"></td>
                                  </tr>
                                  <tr>
                                    <td>5</td>
                                    <td>20</td>
                                    <td><input class="form-control" type="text" name="row5col3" id="row5col3"></td>
                                    <td><input class="form-control" type="text" name="row5col4" id="row5col4"></td>
                                  </tr>
                                  <tr>
                                    <td>6</td>
                                    <td>10</td>
                                    <td><input class="form-control" type="text" name="row6col3" id="row6col3"></td>
                                    <td><input class="form-control" type="text" name="row6col4" id="row6col4"></td>
                                  </tr>
                                  <tr>
                                    <td></td>
                                    <td>Total</td>
                                    <td><input class="form-control" type="text" name="denoTotalNotes"
                                        id="denoTotalNotes"></td>
                                    <td><input class="form-control" type="text" name="denoTotalAmount"
                                        id="denoTotalAmount"></td>
                                  </tr>

                                </tbody>
                              </table>
                            </div>
                          </div>
                          <div id="BankTableContainer" style="display:none;" class="row">
                            <h5>Bank Details :
                            </h5>
                            <div class="row">
                              <div class="col-md-6">
                                <div class="form-group row">
                                  <label class="col-sm-5 col-form-label" for="bankName">Bank Name</label>
                                  <div class="col-sm-5">
                                    <input class="form-control" type="text" id="bankName" name="bankName" />
                                  </div>
                                </div>
                              </div>
                              <div class="col-md-6">
                                <div class="form-group row">
                                  <label class="col-sm-5 col-form-label" for="cdtNo">Cheque / DD No / Transaction
                                    ID</label>
                                  <div class="col-sm-5">
                                    <input class="form-control" type="text" id="cdtNo" name="cdtNo" />
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="form-group row">
                                <label class="col-sm-5 col-form-label" for="cdtDate">
                                  Date</label>
                                <div class="col-sm-5">
                                  <input class="form-control" type="date" id="cdtDate" name="cdtDate" />
                                </div>
                              </div>
                            </div>
                          </div>

                        </div>
                      </div>

                      <div class="d-flex justify-content-end">
                        <!-- <button type="button" class="btn back custom-width"
onclick="window.location.href='block_list.html';">Back</button> -->
                        <button type="submit" class="btn btn-gradient-primary me-2" value="submit">Submit</button>
                        <button class="btn btn-light" onclick="goBack()">Cancel</button>
                      </div>
                  </form>

                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- content-wrapper ends -->
        <!-- partial:../../partials/_footer.html -->
        <div id="includeFooder"></div>
        <!-- partial -->
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->
  <!-- Bootstrap Bundle with Popper.js -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
  <!-- plugins:js -->
<script src="../../assets/vendors/js/vendor.bundle.base.js"></script></script>
 */
  <!-- endinject -->
  <!-- Plugin js for this page -->
  <script src="../../assets/vendors/chart.js/Chart.min.js"></script>
  <!-- End plugin js for this page -->
  <!-- inject:js -->
  <script src="../../assets/js/off-canvas.js"></script>
  <script src="../../assets/js/hoverable-collapse.js"></script>
  <!-- <script src="../../assets/js/pagination.js"></script> -->
  <script src="../../assets/js/menu_active.js"></script>
  <script src="../../assets/js/misc.js"></script>
  <!-- endinject -->
  <!-- Custom js for this page -->
  <script src="../../assets/js/chart.js"></script>
  <!-- endinject -->
  <!-- Custom js for this page -->
  <script src="../../assets/js/file-upload.js"></script>
  <!-- End custom js for this page -->

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    function logout() {
    // Clear local storage
    localStorage.clear();

    // Replace current state with a new state to prevent going back
    window.history.replaceState(null, "", window.location.href);

    // Add an event listener to handle the popstate event
    window.onpopstate = function (event) {
        // Push another state to forward the user
        window.history.pushState(null, "", window.location.href);
    };

    // Redirect to the logout page or perform other logout actions
    window.location.href = '../../index.html';
   }
    const currentDate = new Date();
    const year = currentDate.getFullYear();
    let month = (currentDate.getMonth() + 1).toString().padStart(2, '0'); // Months are zero-based, so add 1
    let day = currentDate.getDate().toString().padStart(2, '0');

    const dateString = `${year}-${month}-${day}`;
    document.getElementById('PaidDate').value = dateString; // Set the value attribute with the formatted date string

    function goBack() {
      window.history.back();
    }
    $(document).ready(function () {
      // Submit data functionality
      const BlockEmployeeEmailId = localStorage.getItem('employeeEmail');
      const BlockEmployeeName = localStorage.getItem('employeeName');
      console.log(BlockEmployeeEmailId, 'hloo');
      const initialBlockEmployeeEmailId = BlockEmployeeEmailId;
      const initialBlockEmployeeName = BlockEmployeeName;
      const accessToken = localStorage.getItem('accessToken');

      // for fetching customer details
      //console.log(employeeNamenew,'hi0');
      const urlParams = new URLSearchParams(window.location.search);

      const phoneNumber = urlParams.get('phoneNumber');
      const currentVisitId = urlParams.get('visitId');
      let currentProjectName = urlParams.get('projectName');
      const designationDropdown = document.getElementById('projectNames');
      const plotDropdown = document.getElementById('plotNumber');
      
      // const currentPlotId = document.getElementById('plotNumber');
      let customerId;
      let SiteVisitEmployeeID;
      let projectId;
      // document.getElementById('blockEmployeeId').value = BlockEmployeeEmailId;
      document.getElementById('BlockEmployeeName').value = BlockEmployeeName;
      document.getElementById('siteVisitProjectName').value = currentProjectName;
      console.log(currentProjectName, 'hi0');
      const accesssToken = localStorage.getItem('accessToken');
      $.ajax({
        url: `http://localhost:8080/api/customer/getCustomerByPhoneNumber/${phoneNumber}`,
        type: 'GET',
        headers: {
          'Authorization': accesssToken
        },
        success: function (data) {
          customerId = data.customerId;
          const customerName = data.customerName;
          const customerEmail = data.customerEmail;
          const customerHouseName = data.address;
          const customerStreet = data.streetName;
          const customerArea = data.area;
          const customerCity = data.city;
          const customerDistrict = data.district;
          const customerState = data.state;
          const customerPostalCode = data.postalCode;

          // document.getElementById('customerid').value = customerId;
          document.getElementById('customername').value = customerName;// this is for seconmd field
          document.getElementById('customerName').value = customerName;// this is for below tab customer details
          document.getElementById('mobileNumber1').value = phoneNumber;
          document.getElementById('email1').value = customerEmail;
          document.getElementById('houseName').value = customerHouseName;
          document.getElementById('streetName').value = customerStreet;
          document.getElementById('area').value = customerArea;

          document.getElementById('city').value = customerCity;
          document.getElementById('district').value = customerDistrict;

          document.getElementById('state').value = customerState;
          document.getElementById('postalCode').value = customerPostalCode;

          console.log(phoneNumber, 'hi0');

          $('#customCode').text(data.customCode);
          $('#mobileNumber').text(data.mobileNumber);
          $('#location').text(data.location);
          $('#email').text(data.customerEmail);
          $('#employeeType').text(data.employeeType);
          $('#workPlace').text(data.workPlace);
          $('#address').text(data.address);

        },
        error: function (xhr, status, error) {
          console.error(xhr.responseText); // Log the error response
          console.error(error); // Log the error message
          showalert('Error fetching customer data from the server. Please try again later.'); // Display an error message to the user
        }
      });
      // const accessToken = localStorage.getItem('accessToken');
      $.ajax({
        url: `http://localhost:8080/api/visit/getVisitDetailsById/${currentVisitId}`,
        type: 'GET',
        headers: {
          'Authorization': accesssToken// Specify the content type as JSON
        },
        success: async function (data) {
          SiteVisitEmployeeID = data.employeeCode;
          const SiteVisitEmployeeName = data.employeeName;
          let projectId = data.projectId;
          let projectName = data.projectName;
          let companyIdforPro = data.companyId
          console.log("id",companyIdforPro);

          fetchPlotIdAndPopulateDropdown(projectId);
          // const customerNames= data.customerName;
          // document.getElementById('SiteVisitEmployeeID').value = SiteVisitEmployeeID;
          document.getElementById('SiteVisitEmployeeName').value = SiteVisitEmployeeName;
        },
        error: function (xhr, status, error) {
          console.error(xhr.responseText); // Log the error response
          console.error(error); // Log the error message
          showalert('Error fetching visit data from the server. Please try again later.'); // Display an error message to the user
        }
      });

      //Project N
      let projectIdnew;
      let teamIdFromProjectTable;

      async function fetchPlotIdAndPopulateDropdown(projectId) {
        const workingProjectName = urlParams.get('projectName');
        const accessToken = localStorage.getItem('accessToken');
        console.log("workingProjectName:", workingProjectName);
        try {
          // Fetch companies from the backend
          const responseCompanies = await fetch(`http://localhost:8080/api/project/getProjectLayoutByProjectName/${workingProjectName}`,
            {
              headers: {
                'Content-Type': 'application/json',
                'Authorization': accessToken // Specify the content type as JSON
              },
            }
          );
          if (!responseCompanies.ok) {
            throw new Error('Failed to fetch projectLayouts');
          }
          const plots = await responseCompanies.json();
          console.log("projectId", projectId);
          // Fetch block details
          $.ajax({
            url: `http://localhost:8080/api/blocks/getBlockDetailsByVisitIdAndProjectName/${currentVisitId}/${workingProjectName}`,
            type: 'GET',
            headers: {
              'Authorization': accessToken // Specify the content type as JSON
            },
            success: function (blockData) {
              // Filter plots that are not in blockData
              const filteredPlots = plots.filter(plot => {
                return !blockData.some(visit => visit.plotNumber === plot.plotNumber);
              });

              // Populate the dropdown with filtered plots
              filteredPlots.forEach(plot => {
                const plotOption = document.createElement('option');
                plotOption.value = plot.plotNumber;
                plotOption.textContent = plot.plotNumber;
                plotDropdown.appendChild(plotOption);
              });
            },
            error: function (xhr, status, error) {
              console.error('Error fetching block details:', error);

              plots.forEach(plot => {
                const plotOption = document.createElement('option');
                plotOption.value = plot.plotNumber;
                plotOption.textContent = plot.plotNumber;
                plotDropdown.appendChild(plotOption);
              });
            }
          });
        } catch (error) {
          console.error('Error:', error);
          // showalert('Failed to fetch companies');
        }
      }

      document.getElementById('BlockForm').addEventListener('submit', async function (event) {
        event.preventDefault();
        // if (plotNumber === " ") {
        // showalert('Please select a Plot Number.');
        // event.preventDefault(); // Prevent form submission if validation fails
        // }
        // const sellingRateValues = sellingRate.value;
        // console.log("sellingRate",sellingRateValues);// Replace with your actual input field
        // Validate selling rate
        // const sellingRateValue = document.getElementById('sellingRate').value;
        // console.log("seling Rate",sellingRateValue);
        // if (sellingRateValue ===" ") {
        // showalert('Please enter a Selling Rate.');
        // return; // Prevent form submission if validation fails
        // }

        const formData = new FormData();
        const plotNamesfromForm = plotDropdown.value;
        const siteVisitId = currentVisitId;
        // var currentDate = new Date();
        // var formattedDate = currentDate.toISOString();
        // const projectNameFromSiteVisit=currentProjectName;
        // // Assign the formatted date to the paidDate variable
        // var paidDate = formattedDate;
        
        const BlockEmployeeEmailIdValue = localStorage.getItem('employeeEmail');
        const teamIdFromProjectTableValue = teamIdFromProjectTable;
        let paidAmountValue = document.getElementById('paidAmount').value;
          const companyId = urlParams.get('companyId');
          const teamId = urlParams.get('teamId');
          
        

        // Check if the value is empty or null
        if (paidAmountValue === "" || paidAmountValue === null) {
          // If it is empty or null, set paidAmountValue to 0
          paidAmountValue = 0;
        }
        console.log("paidAmount:", paidAmountValue);

        const blocks = {
          customerId: customerId,
          customerName: document.getElementById('customerName').value,
          visitId: siteVisitId,
          mobileNumber: document.getElementById('mobileNumber').innerText,
          customerCode: document.getElementById('customCode').innerText,
          siteVisitEmpId: SiteVisitEmployeeID,
          siteVisitEmpName: document.getElementById('SiteVisitEmployeeName').value,
          blockEmpId: BlockEmployeeEmailIdValue,
          blockEmpName: document.getElementById('BlockEmployeeName').value,
          preferLocation: document.getElementById('location').innerText,
          employeeType: document.getElementById('employeeType').innerText,
          employeeCode: BlockEmployeeEmailIdValue,
          workPlace: document.getElementById('workPlace').innerText,
          address: document.getElementById('address').innerText,
          email: document.getElementById('email').innerText,
          houseName: document.getElementById('houseName').value,
          streetName: document.getElementById('streetName').value,
          area: document.getElementById('area').value,
          city: document.getElementById('city').value,
          district: document.getElementById('district').value,
          state: document.getElementById('state').value,
          postalCode: document.getElementById('postalCode').value,

          projectName: currentProjectName,
          projectId: projectId, // Use selectedCompanyId instead of companyId

          plotId: document.getElementById('plotNumber').value,
          plotNumber: plotNamesfromForm,
          totalSqft: document.getElementById('totalsqrt').value,
          ratePerSqft: document.getElementById('rate').value,
          totalValues: document.getElementById('totalValues').value,
          description: document.getElementById('description').value,
          sellingRate: document.getElementById('sellingRate').value,
          plotTotalAmount: document.getElementById('totalAmount').value,
          discount: document.getElementById('discount').value,
          netAmount: document.getElementById('netAmount').value,
          paidAmount: paidAmountValue,
          paidDate: dateString,
          paymentType: document.getElementById('PaymentType').value,
          paymentMode: document.getElementById('PaymentMode').value,
          deno500: document.getElementById('row1col3').value,
          denoa500: document.getElementById('row1col4').value,
          deno200: document.getElementById('row2col3').value,
          denoa200: document.getElementById('row2col4').value,
          deno100: document.getElementById('row3col3').value,
          denoa100: document.getElementById('row3col4').value,
          deno50: document.getElementById('row4col3').value,
          denoa50: document.getElementById('row4col4').value,
          deno20: document.getElementById('row5col3').value,
          denoa20: document.getElementById('row5col4').value,
          deno10: document.getElementById('row6col3').value,
          denoa10: document.getElementById('row6col4').value,
          denoTotalNotes: document.getElementById('denoTotalNotes').value,
          denoTotalAmount: document.getElementById('denoTotalAmount').value,
          bankName: document.getElementById('bankName').value,
          cdtNo: document.getElementById('cdtNo').value,
          cdtDate: document.getElementById('cdtDate').value,
          paidBy: document.getElementById('PaidBy').value,
          receivedBy: document.getElementById('ReceivedBy').value,
            companyId: companyId,
            teamId: teamId,
          // location: document.getElementById('location').innerText,
          // project: ProjectNamesDropdown.value,
          // companyId: document.getElementById('companyId').value,
          // Add similar lines for other fields if needed
        };
        console.log(blocks);
        //formData.append('blocks', new Blob([JSON.stringify(blocks)], { type: 'application/json' }));
        // ... (remaining file upload logic)
        (async () => {
          try {
            const response = await fetch('http://localhost:8080/api/blocks/addBlocks', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json', // Specify the content type as JSON
                'Authorization': accessToken
              },
              body: JSON.stringify(blocks), // Convert the JavaScript object to JSON string
              credentials: 'include',
            });

            if (!response.ok) {
              console.log("response:", response);
              throw new Error('Failed to add blocks');
            }
            showalert('Block Details added successfully');

            // ----- Making the isblock true in site visit list ----- //
            const findByVisitIdAndProjectNameResponse = await fetch(`http://localhost:8080/api/visit/getByVisitDetailIdAndProjectNameForBlock/${blocks.visitId}/${blocks.projectName}`, 
            {
              method: 'PUT',
              headers: {
                'Authorization': accessToken
              },
              credentials: 'include'
            });

            if (!findByVisitIdAndProjectNameResponse.ok) {
              throw new Error('Failed to update Visit Details');
            }

            const visitDetails = await findByVisitIdAndProjectNameResponse.json();
            console.log('Visit Details:', visitDetails);

            window.history.back();

            // Optionally, redirect or perform any other action upon successful submission

          } catch (error) {
            console.log("response:", response);
            console.error('Error:', error);
            showalert(`An error occurred: ${error.message}`);
          }
        })();

        // Optionally, redirect or perform any other action upon successful submission
      });
      $('#plotNumber').change(function () {
        var selectedPlot = $(this).val();
        if (selectedPlot) {

          $.ajax({
            url: `http://localhost:8080/api/visit/getVisitDetailsById/${currentVisitId}`,
            type: 'GET',
            headers:
            {
              'Authorization': accessToken// Specify the content type as JSON
            },
            success: async function (data) {

              const newlyWorkingProjectName = urlParams.get('projectName');

              $.ajax({
                url: `http://localhost:8080/api/project/getProjectLayoutDetailsByProjectNameAndPlotNumber/${newlyWorkingProjectName}/${selectedPlot}`, // Replace 'your_server_endpoint' with the actual URL to fetch total square footage
                method: 'GET',
                // data: { plot: selectedPlot },
                headers: {
                  'Authorization': accessToken// Specify the content type as JSON
                },
                success: function (response) {
                  $('#totalsqrt').val(response.totalSqft); // Assuming the response contains the total square footage
                  $('#status').val(response.status);
                  $('#rate').val(response.rate);
                  $('#totalValues').val(response.totalValue);
                  $('#description').val(response.descrip);
                  //BlockForm :payment page
                  $('#totaSqft').val(response.totalSqft);
                  projectId = response.projectId;
                  console.log("proid",projectId);
                  teamIdFromProjectTable = response.teamId;
                  console.log("teamIdFromProjectTable", teamIdFromProjectTable);
                },
                error: function (xhr, status, error) {
                  console.error('Error fetching total square footage:', error);
                }
              });
            },
            error: function (xhr, status, error) {
              console.error('Error fetching total square footage:', error);
            }
          });
        }
        else {
          $('#totalsqrt').val(''); // Clear the total square footage input if no plot is selected
        }
      });

      $('#sellingRate').change(function () {
        var totalSqft = $('#totaSqft').val(); // Fetch total square footage
        var rate = $('#sellingRate').val(); // Fetch rate
        var totalValues = totalSqft * rate;
        $('#totalAmount').val(totalValues);
      });
      $('#discount').change(function () {
        var totalAmountValue = $('#totalAmount').val();
        var discountValue = $('#discount').val(); // Fetch total square footage
        console.log("good");
        // Fetch rate

        // Check if both totalSqft and rate are valid numbers

        // Calculate total values by multiplying totalSqft by rate
        var netAmountValues = totalAmountValue - (totalAmountValue / discountValue);
        // Set the calculated totalValues to the totalValues field
        $('#netAmount').val(netAmountValues);

      });

      $('input[name^="row"][name$="col3"]').change(function () {
        var totalNotes = 0;
        $('input[name^="row"][name$="col3"]').each(function () {
          var value = parseFloat($(this).val());
          if (!isNaN(value)) {
            console.log(totalNotes, "shanmathi");
            totalNotes += value;
          }
        });
        $('#denoTotalNotes').val(totalNotes);
      });
      $('input[name^="row"][name$="col3"]').change(function () {
        var totalNotes = 0;
        var totalAmounts = 0;

        // Iterate over all col3 inputs to calculate totalNotes and update corresponding col4 values
        $('input[name^="row"][name$="col3"]').each(function () {
          var value = parseFloat($(this).val());
          if (!isNaN(value)) {
            var currentRow = $(this).closest('tr');
            var rupees = parseFloat(currentRow.find('td:nth-child(2)').text());

            // Calculate total amount for the corresponding col4 input
            if (!isNaN(rupees)) {
              var totalAmount = rupees * value;
              currentRow.find('input[name$="col4"]').val(totalAmount);
              totalAmounts += totalAmount;
            }

            // Update totalNotes
            totalNotes += value;
          }
        });

        // Set the calculated totalNotes and totalAmounts to their respective input fields
        $('#denoTotalNotes').val(totalNotes);
        $('#denoTotalAmount').val(totalAmounts);
      });
    });

    $(document).ready(function () {
      $('#alterMobile,#employeeMobile').on('input', function () {
        var phoneNumber = $(this).val();

        // Check if the input contains letters
        if (/[a-zA-Z]/.test(phoneNumber)) {
          showalert('Please enter digits only.');
          phoneNumber = phoneNumber.replace(/[a-zA-Z]/g, '');
        }

        // Remove any non-digit characters
        phoneNumber = phoneNumber.replace(/\D/g, '');

        // Limit to 12 digits
        if (phoneNumber.length > 12) {
          showalert('Please enter a maximum of 12 digits.');
          phoneNumber = phoneNumber.substr(0, 12);
        }

        $(this).val(phoneNumber);
      });
    });

    $(document).ready(function () {
      $('#bankName').on('input', function () {
        var inputValue = $(this).val();
        // Check if the input contains any numeric characters
        if (/\d/.test(inputValue)) {
          showalert('Please enter alphabetic characters only.');
          // Remove the numeric characters
          $(this).val(inputValue.replace(/\d/g, ''));
        }
        // Check if the input contains any special characters
        if (/[^\w\s]/.test(inputValue)) {
          showalert('Special characters are not allowed.');
          // Remove the special characters
          $(this).val(inputValue.replace(/[^\w\s]/g, ''));
        }
        // Check if the input length exceeds the limit
        if (inputValue.length > 50) {
          showalert('Maximum length exceeded. Please enter up to 50 characters.');
          // Trim the input to the maximum length
          $(this).val(inputValue.slice(0, 50));
        }
      });
    });

    function validateInputNumeric(event) {
      const inputValue = event.target.value;
      const numericRegex = /^[0-9]*$/; // Regular expression to match numeric characters
      if (!numericRegex.test(inputValue)) {
        event.target.style.borderColor = 'red'; // Set border color to red
        event.target.setCustomValidity("Only numeric characters are allowed."); // Set validation message
        event.target.reportValidity(); // Show validation message
        event.target.value = inputValue.replace(/\D/g, ''); // Remove non-numeric characters
      }
      else {
        event.target.style.borderColor = ''; // Reset border color
        event.target.setCustomValidity(""); // Clear validation message
      }
    }
    $(document).ready(function () {
      $('#employeeEmail').on('input', function () {
        var inputValue = $(this).val();
        // Check if the input contains any numeric character
        // Check if the input contains any spaces
        if (/\s/.test(inputValue)) {
          showalert('Spaces are not allowed.');
          // Remove the spaces
          $(this).val(inputValue.replace(/\s/g, ''));
        }
        // Check if the input length exceeds the limit
        if (inputValue.length > 50) {
          showalert('Maximum length exceeded. Please enter up to 100 characters.');
          // Trim the input to the maximum length
          $(this).val(inputValue.slice(0, 100));
        }
      });
    });
    $(document).ready(function () {
      $('#location').on('input', function () {
        var inputValue = $(this).val();
        // Check if the input contains any numeric characters
        // Check if the input length exceeds the limit
        if (inputValue.length > 50) {
          showalert('Maximum length exceeded. Please enter up to 50 characters.');
          // Trim the input to the maximum length
          $(this).val(inputValue.slice(0, 50));
        }
      });
    });
    $(document).ready(function () {
      $('#cdtNo').on('input', function () {
        var inputValue = $(this).val();
        // Check if the input contains any numeric characters
        // Check if the input length exceeds the limit
        if (inputValue.length > 50) {
          showalert('Maximum length exceeded. Please enter up to 50 characters.');
          // Trim the input to the maximum length
          $(this).val(inputValue.slice(0, 50));

        }
      });
    });
    
  </script>

  <script>
    // Define the function outside of $(document).ready() scope
    function toggleDenominationTable() {
      // Prevent the default form submission behavior
      event.preventDefault();

      // Toggle the visibility of the denomination table
      var tableContainer = document.getElementById("denominationTableContainer");
      if (tableContainer.style.display === "none") {
        tableContainer.style.display = "block";
      } else {
        tableContainer.style.display = "none";
      }
    }
    function toggleCardTransactionTable() {
      // Prevent the default form submission behavior
      event.preventDefault();

      // Toggle the visibility of the denomination table
      var tableContainer = document.getElementById("BankTableContainer");
      if (tableContainer.style.display === "none") {
        tableContainer.style.display = "block";
      } else {
        tableContainer.style.display = "none";
      }
    }
    function validateInputString(event) {
      const inputValue = event.target.value;
      const alphaRegex = /^[a-zA-Z\s]*$/; // Regular expression to match only alphabetic characters and spaces

      if (!alphaRegex.test(inputValue)) {
        event.target.style.borderColor = 'red'; // Set border color to red
        event.target.setCustomValidity("Only alphabetic characters are allowed."); // Set validation message
        event.target.reportValidity(); // Show validation message
        event.target.value = inputValue.replace(/[^a-zA-Z\s]/g, ''); // Remove non-alphabetic characters
      } else {
        event.target.style.borderColor = ''; // Reset border color
        event.target.setCustomValidity(""); // Clear validation message
      }
    }
  </script>
</body>

</html>